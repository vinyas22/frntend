import './polyfills.server.mjs';
import{a as qt,b as Mt}from"./chunk-7RCM54JU.mjs";import{a as M,b as Z,c as E,e as S,f as Mn,g as B}from"./chunk-FME56UVT.mjs";var Ps=S((ga,Bs)=>{"use strict";var _e=E("fs"),As=E("url"),Wn=E("child_process").spawn;Bs.exports=Wt;Wt.XMLHttpRequest=Wt;function Wt(s){"use strict";s=s||{};var e=this,t=E("http"),r=E("https"),n,i,a={},l=!1,h={"User-Agent":"node-XMLHttpRequest",Accept:"*/*"},u=Object.assign({},h),o=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","content-transfer-encoding","cookie","cookie2","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"],c=["TRACE","TRACK","CONNECT"],f=!1,_=!1,y=!1,d={};this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.onreadystatechange=null,this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),this.status=null,this.statusText=null;var m=function(p){return l||p&&o.indexOf(p.toLowerCase())===-1},b=function(p){return p&&c.indexOf(p)===-1};this.open=function(p,g,F,w,A){if(this.abort(),_=!1,y=!1,!b(p))throw new Error("SecurityError: Request method not allowed");a={method:p,url:g.toString(),async:typeof F!="boolean"?!0:F,user:w||null,password:A||null},x(this.OPENED)},this.setDisableHeaderCheck=function(p){l=p},this.setRequestHeader=function(p,g){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: setRequestHeader can only be called when state is OPEN");if(!m(p))return console.warn('Refused to set unsafe header "'+p+'"'),!1;if(f)throw new Error("INVALID_STATE_ERR: send flag is true");return u[p]=g,!0},this.getResponseHeader=function(p){return typeof p=="string"&&this.readyState>this.OPENED&&i.headers[p.toLowerCase()]&&!_?i.headers[p.toLowerCase()]:null},this.getAllResponseHeaders=function(){if(this.readyState<this.HEADERS_RECEIVED||_)return"";var p="";for(var g in i.headers)g!=="set-cookie"&&g!=="set-cookie2"&&(p+=g+": "+i.headers[g]+`\r
`);return p.substr(0,p.length-2)},this.getRequestHeader=function(p){return typeof p=="string"&&u[p]?u[p]:""},this.send=function(p){if(this.readyState!=this.OPENED)throw new Error("INVALID_STATE_ERR: connection must be opened before send() is called");if(f)throw new Error("INVALID_STATE_ERR: send has already been called");var g=!1,F=!1,w=As.parse(a.url),A;switch(w.protocol){case"https:":g=!0;case"http:":A=w.hostname;break;case"file:":F=!0;break;case void 0:case"":A="localhost";break;default:throw new Error("Protocol not supported.")}if(F){if(a.method!=="GET")throw new Error("XMLHttpRequest: Only GET method is supported");if(a.async)_e.readFile(unescape(w.pathname),function(U,fe){U?e.handleError(U,U.errno||-1):(e.status=200,e.responseText=fe.toString("utf8"),e.response=fe,x(e.DONE))});else try{this.response=_e.readFileSync(unescape(w.pathname)),this.responseText=this.response.toString("utf8"),this.status=200,x(e.DONE)}catch(U){this.handleError(U,U.errno||-1)}return}var I=w.port||(g?443:80),z=w.pathname+(w.search?w.search:"");if(u.Host=A,g&&I===443||I===80||(u.Host+=":"+w.port),a.user){typeof a.password>"u"&&(a.password="");var Bt=new Buffer(a.user+":"+a.password);u.Authorization="Basic "+Bt.toString("base64")}if(a.method==="GET"||a.method==="HEAD")p=null;else if(p){u["Content-Length"]=Buffer.isBuffer(p)?p.length:Buffer.byteLength(p);var Bn=Object.keys(u);Bn.some(function(U){return U.toLowerCase()==="content-type"})||(u["Content-Type"]="text/plain;charset=UTF-8")}else a.method==="POST"&&(u["Content-Length"]=0);var Pn=s.agent||!1,J={host:A,port:I,path:z,method:a.method,headers:u,agent:Pn};if(g&&(J.pfx=s.pfx,J.key=s.key,J.passphrase=s.passphrase,J.cert=s.cert,J.ca=s.ca,J.ciphers=s.ciphers,J.rejectUnauthorized=s.rejectUnauthorized!==!1),_=!1,a.async){var Pt=g?r.request:t.request;f=!0,e.dispatchEvent("readystatechange");var Dt=function(U){if(i=U,i.statusCode===302||i.statusCode===303||i.statusCode===307){a.url=i.headers.location;var fe=As.parse(a.url);A=fe.hostname;var oe={hostname:fe.hostname,port:fe.port,path:fe.path,method:i.statusCode===303?"GET":a.method,headers:u};g&&(oe.pfx=s.pfx,oe.key=s.key,oe.passphrase=s.passphrase,oe.cert=s.cert,oe.ca=s.ca,oe.ciphers=s.ciphers,oe.rejectUnauthorized=s.rejectUnauthorized!==!1),n=Pt(oe,Dt).on("error",It),n.end();return}x(e.HEADERS_RECEIVED),e.status=i.statusCode,i.on("data",function(tt){if(tt){var qn=Buffer.from(tt);e.response=Buffer.concat([e.response,qn])}f&&x(e.LOADING)}),i.on("end",function(){f&&(f=!1,x(e.DONE),e.responseText=e.response.toString("utf8"))}),i.on("error",function(tt){e.handleError(tt)})},It=function(U){if(n.reusedSocket&&U.code==="ECONNRESET")return Pt(J,Dt).on("error",It);e.handleError(U)};n=Pt(J,Dt).on("error",It),s.autoUnref&&n.on("socket",U=>{U.unref()}),p&&n.write(p),n.end(),e.dispatchEvent("loadstart")}else{var Re=".node-xmlhttprequest-content-"+process.pid,Le=".node-xmlhttprequest-sync-"+process.pid;_e.writeFileSync(Le,"","utf8");for(var Dn="var http = require('http'), https = require('https'), fs = require('fs');var doRequest = http"+(g?"s":"")+".request;var options = "+JSON.stringify(J)+";var responseText = '';var responseData = Buffer.alloc(0);var req = doRequest(options, function(response) {response.on('data', function(chunk) {  var data = Buffer.from(chunk);  responseText += data.toString('utf8');  responseData = Buffer.concat([responseData, data]);});response.on('end', function() {fs.writeFileSync('"+Re+"', JSON.stringify({err: null, data: {statusCode: response.statusCode, headers: response.headers, text: responseText, data: responseData.toString('base64')}}), 'utf8');fs.unlinkSync('"+Le+"');});response.on('error', function(error) {fs.writeFileSync('"+Re+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+Le+"');});}).on('error', function(error) {fs.writeFileSync('"+Re+"', 'NODE-XMLHTTPREQUEST-ERROR:' + JSON.stringify(error), 'utf8');fs.unlinkSync('"+Le+"');});"+(p?"req.write('"+JSON.stringify(p).slice(1,-1).replace(/'/g,"\\'")+"');":"")+"req.end();",In=Wn(process.argv[0],["-e",Dn]),ma;_e.existsSync(Le););if(e.responseText=_e.readFileSync(Re,"utf8"),In.stdin.end(),_e.unlinkSync(Re),e.responseText.match(/^NODE-XMLHTTPREQUEST-ERROR:/)){var Un=JSON.parse(e.responseText.replace(/^NODE-XMLHTTPREQUEST-ERROR:/,""));e.handleError(Un,503)}else{e.status=e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:([0-9]*),.*/,"$1");var Ut=JSON.parse(e.responseText.replace(/^NODE-XMLHTTPREQUEST-STATUS:[0-9]*,(.*)/,"$1"));i={statusCode:e.status,headers:Ut.data.headers},e.responseText=Ut.data.text,e.response=Buffer.from(Ut.data.data,"base64"),x(e.DONE,!0)}}},this.handleError=function(p,g){this.status=g||0,this.statusText=p,this.responseText=p.stack,_=!0,x(this.DONE)},this.abort=function(){n&&(n.abort(),n=null),u=Object.assign({},h),this.responseText="",this.responseXML="",this.response=Buffer.alloc(0),_=y=!0,this.readyState!==this.UNSENT&&(this.readyState!==this.OPENED||f)&&this.readyState!==this.DONE&&(f=!1,x(this.DONE)),this.readyState=this.UNSENT},this.addEventListener=function(p,g){p in d||(d[p]=[]),d[p].push(g)},this.removeEventListener=function(p,g){p in d&&(d[p]=d[p].filter(function(F){return F!==g}))},this.dispatchEvent=function(p){if(typeof e["on"+p]=="function"&&(this.readyState===this.DONE&&a.async?setTimeout(function(){e["on"+p]()},0):e["on"+p]()),p in d)for(let g=0,F=d[p].length;g<F;g++)this.readyState===this.DONE?setTimeout(function(){d[p][g].call(e)},0):d[p][g].call(e)};var x=function(p){if(!(e.readyState===p||e.readyState===e.UNSENT&&y)&&(e.readyState=p,(a.async||e.readyState<e.OPENED||e.readyState===e.DONE)&&e.dispatchEvent("readystatechange"),e.readyState===e.DONE)){let g;y?g="abort":_?g="error":g="load",e.dispatchEvent(g),e.dispatchEvent("loadend")}}}});var Gt=S((Ra,Ys)=>{"use strict";function Xn(s){t.debug=t,t.default=t,t.coerce=h,t.disable=i,t.enable=n,t.enabled=a,t.humanize=qt(),t.destroy=u,Object.keys(s).forEach(o=>{t[o]=s[o]}),t.names=[],t.skips=[],t.formatters={};function e(o){let c=0;for(let f=0;f<o.length;f++)c=(c<<5)-c+o.charCodeAt(f),c|=0;return t.colors[Math.abs(c)%t.colors.length]}t.selectColor=e;function t(o){let c,f=null,_,y;function d(...m){if(!d.enabled)return;let b=d,x=Number(new Date),p=x-(c||x);b.diff=p,b.prev=c,b.curr=x,c=x,m[0]=t.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let g=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(w,A)=>{if(w==="%%")return"%";g++;let I=t.formatters[A];if(typeof I=="function"){let z=m[g];w=I.call(b,z),m.splice(g,1),g--}return w}),t.formatArgs.call(b,m),(b.log||t.log).apply(b,m)}return d.namespace=o,d.useColors=t.useColors(),d.color=t.selectColor(o),d.extend=r,d.destroy=t.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(_!==t.namespaces&&(_=t.namespaces,y=t.enabled(o)),y),set:m=>{f=m}}),typeof t.init=="function"&&t.init(d),d}function r(o,c){let f=t(this.namespace+(typeof c>"u"?":":c)+o);return f.log=this.log,f}function n(o){t.save(o),t.namespaces=o,t.names=[],t.skips=[];let c,f=(typeof o=="string"?o:"").split(/[\s,]+/),_=f.length;for(c=0;c<_;c++)f[c]&&(o=f[c].replace(/\*/g,".*?"),o[0]==="-"?t.skips.push(new RegExp("^"+o.slice(1)+"$")):t.names.push(new RegExp("^"+o+"$")))}function i(){let o=[...t.names.map(l),...t.skips.map(l).map(c=>"-"+c)].join(",");return t.enable(""),o}function a(o){if(o[o.length-1]==="*")return!0;let c,f;for(c=0,f=t.skips.length;c<f;c++)if(t.skips[c].test(o))return!1;for(c=0,f=t.names.length;c<f;c++)if(t.names[c].test(o))return!0;return!1}function l(o){return o.toString().substring(2,o.toString().length-2).replace(/\.\*\?$/,"*")}function h(o){return o instanceof Error?o.stack||o.message:o}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Ys.exports=Xn});var Ks=S((W,ot)=>{"use strict";W.formatArgs=Kn;W.save=Jn;W.load=Qn;W.useColors=Yn;W.storage=Zn();W.destroy=(()=>{let s=!1;return()=>{s||(s=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();W.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Yn(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let s;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(s=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(s[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Kn(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+ot.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;s.splice(1,0,e,"color: inherit");let t=0,r=0;s[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(t++,n==="%c"&&(r=t))}),s.splice(r,0,e)}W.log=console.debug||console.log||(()=>{});function Jn(s){try{s?W.storage.setItem("debug",s):W.storage.removeItem("debug")}catch{}}function Qn(){let s;try{s=W.storage.getItem("debug")}catch{}return!s&&typeof process<"u"&&"env"in process&&(s=process.env.DEBUG),s}function Zn(){try{return localStorage}catch{}}ot.exports=Gt()(W);var{formatters:ei}=ot.exports;ei.j=function(s){try{return JSON.stringify(s)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Qs=S((N,ct)=>{"use strict";var ti=E("tty"),at=E("util");N.init=ci;N.log=ii;N.formatArgs=ri;N.save=oi;N.load=ai;N.useColors=si;N.destroy=at.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");N.colors=[6,2,3,4,5,1];try{let s=Mt();s&&(s.stderr||s).level>=2&&(N.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}N.inspectOpts=Object.keys(process.env).filter(s=>/^debug_/i.test(s)).reduce((s,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),s[t]=r,s},{});function si(){return"colors"in N.inspectOpts?!!N.inspectOpts.colors:ti.isatty(process.stderr.fd)}function ri(s){let{namespace:e,useColors:t}=this;if(t){let r=this.color,n="\x1B[3"+(r<8?r:"8;5;"+r),i=`  ${n};1m${e} \x1B[0m`;s[0]=i+s[0].split(`
`).join(`
`+i),s.push(n+"m+"+ct.exports.humanize(this.diff)+"\x1B[0m")}else s[0]=ni()+e+" "+s[0]}function ni(){return N.inspectOpts.hideDate?"":new Date().toISOString()+" "}function ii(...s){return process.stderr.write(at.formatWithOptions(N.inspectOpts,...s)+`
`)}function oi(s){s?process.env.DEBUG=s:delete process.env.DEBUG}function ai(){return process.env.DEBUG}function ci(s){s.inspectOpts={};let e=Object.keys(N.inspectOpts);for(let t=0;t<e.length;t++)s.inspectOpts[e[t]]=N.inspectOpts[e[t]]}ct.exports=Gt()(N);var{formatters:Js}=ct.exports;Js.o=function(s){return this.inspectOpts.colors=this.useColors,at.inspect(s,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};Js.O=function(s){return this.inspectOpts.colors=this.useColors,at.inspect(s,this.inspectOpts)}});var he=S((La,zt)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?zt.exports=Ks():zt.exports=Qs()});var lr=S((Ja,cr)=>{"use strict";var{Duplex:di}=E("stream");function or(s){s.emit("close")}function pi(){!this.destroyed&&this._writableState.finished&&this.destroy()}function ar(s){this.removeListener("error",ar),this.destroy(),this.listenerCount("error")===0&&this.emit("error",s)}function mi(s,e){let t=!0,r=new di(Z(M({},e),{autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1}));return s.on("message",function(i,a){let l=!a&&r._readableState.objectMode?i.toString():i;r.push(l)||s.pause()}),s.once("error",function(i){r.destroyed||(t=!1,r.destroy(i))}),s.once("close",function(){r.destroyed||r.push(null)}),r._destroy=function(n,i){if(s.readyState===s.CLOSED){i(n),process.nextTick(or,r);return}let a=!1;s.once("error",function(h){a=!0,i(h)}),s.once("close",function(){a||i(n),process.nextTick(or,r)}),t&&s.terminate()},r._final=function(n){if(s.readyState===s.CONNECTING){s.once("open",function(){r._final(n)});return}s._socket!==null&&(s._socket._writableState.finished?(n(),r._readableState.endEmitted&&r.destroy()):(s._socket.once("finish",function(){n()}),s.close()))},r._read=function(){s.isPaused&&s.resume()},r._write=function(n,i,a){if(s.readyState===s.CONNECTING){s.once("open",function(){r._write(n,i,a)});return}s.send(n,a)},r.on("end",pi),r.on("error",ar),r}cr.exports=mi});var ae=S((Za,fr)=>{"use strict";fr.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}});var Ue=S((ec,ht)=>{"use strict";var{EMPTY_BUFFER:gi}=ae(),Kt=Buffer[Symbol.species];function _i(s,e){if(s.length===0)return gi;if(s.length===1)return s[0];let t=Buffer.allocUnsafe(e),r=0;for(let n=0;n<s.length;n++){let i=s[n];t.set(i,r),r+=i.length}return r<e?new Kt(t.buffer,t.byteOffset,r):t}function hr(s,e,t,r,n){for(let i=0;i<n;i++)t[r+i]=s[i]^e[i&3]}function ur(s,e){for(let t=0;t<s.length;t++)s[t]^=e[t&3]}function yi(s){return s.length===s.buffer.byteLength?s.buffer:s.buffer.slice(s.byteOffset,s.byteOffset+s.length)}function Jt(s){if(Jt.readOnly=!0,Buffer.isBuffer(s))return s;let e;return s instanceof ArrayBuffer?e=new Kt(s):ArrayBuffer.isView(s)?e=new Kt(s.buffer,s.byteOffset,s.byteLength):(e=Buffer.from(s),Jt.readOnly=!1),e}ht.exports={concat:_i,mask:hr,toArrayBuffer:yi,toBuffer:Jt,unmask:ur};if(!process.env.WS_NO_BUFFER_UTIL)try{let s=E("bufferutil");ht.exports.mask=function(e,t,r,n,i){i<48?hr(e,t,r,n,i):s.mask(e,t,r,n,i)},ht.exports.unmask=function(e,t){e.length<32?ur(e,t):s.unmask(e,t)}}catch{}});var mr=S((tc,pr)=>{"use strict";var dr=Symbol("kDone"),Qt=Symbol("kRun"),Zt=class{constructor(e){this[dr]=()=>{this.pending--,this[Qt]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Qt]()}[Qt](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[dr])}}};pr.exports=Zt});var We=S((sc,Cr)=>{"use strict";var qe=E("zlib"),gr=Ue(),Ci=mr(),{kStatusCode:_r}=ae(),bi=Buffer[Symbol.species],Ei=Buffer.from([0,0,255,255]),pt=Symbol("permessage-deflate"),re=Symbol("total-length"),Me=Symbol("callback"),ce=Symbol("buffers"),dt=Symbol("error"),ut,es=class{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!ut){let n=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;ut=new Ci(n)}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[Me];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(n=>!(t.serverNoContextTakeover===!1&&n.server_no_context_takeover||n.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>n.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!n.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{let n=t[r];if(n.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(n=n[0],r==="client_max_window_bits"){if(n!==!0){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else if(r==="server_max_window_bits"){let i=+n;if(!Number.isInteger(i)||i<8||i>15)throw new TypeError(`Invalid value for parameter "${r}": ${n}`);n=i}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(n!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${n}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=n})}),e}decompress(e,t,r){ut.add(n=>{this._decompress(e,t,(i,a)=>{n(),r(i,a)})})}compress(e,t,r){ut.add(n=>{this._compress(e,t,(i,a)=>{n(),r(i,a)})})}_decompress(e,t,r){let n=this._isServer?"client":"server";if(!this._inflate){let i=`${n}_max_window_bits`,a=typeof this.params[i]!="number"?qe.Z_DEFAULT_WINDOWBITS:this.params[i];this._inflate=qe.createInflateRaw(Z(M({},this._options.zlibInflateOptions),{windowBits:a})),this._inflate[pt]=this,this._inflate[re]=0,this._inflate[ce]=[],this._inflate.on("error",vi),this._inflate.on("data",yr)}this._inflate[Me]=r,this._inflate.write(e),t&&this._inflate.write(Ei),this._inflate.flush(()=>{let i=this._inflate[dt];if(i){this._inflate.close(),this._inflate=null,r(i);return}let a=gr.concat(this._inflate[ce],this._inflate[re]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[re]=0,this._inflate[ce]=[],t&&this.params[`${n}_no_context_takeover`]&&this._inflate.reset()),r(null,a)})}_compress(e,t,r){let n=this._isServer?"server":"client";if(!this._deflate){let i=`${n}_max_window_bits`,a=typeof this.params[i]!="number"?qe.Z_DEFAULT_WINDOWBITS:this.params[i];this._deflate=qe.createDeflateRaw(Z(M({},this._options.zlibDeflateOptions),{windowBits:a})),this._deflate[re]=0,this._deflate[ce]=[],this._deflate.on("data",xi)}this._deflate[Me]=r,this._deflate.write(e),this._deflate.flush(qe.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let i=gr.concat(this._deflate[ce],this._deflate[re]);t&&(i=new bi(i.buffer,i.byteOffset,i.length-4)),this._deflate[Me]=null,this._deflate[re]=0,this._deflate[ce]=[],t&&this.params[`${n}_no_context_takeover`]&&this._deflate.reset(),r(null,i)})}};Cr.exports=es;function xi(s){this[ce].push(s),this[re]+=s.length}function yr(s){if(this[re]+=s.length,this[pt]._maxPayload<1||this[re]<=this[pt]._maxPayload){this[ce].push(s);return}this[dt]=new RangeError("Max payload size exceeded"),this[dt].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[dt][_r]=1009,this.removeListener("data",yr),this.reset()}function vi(s){this[pt]._inflate=null,s[_r]=1007,this[Me](s)}});var je=S((nc,mt)=>{"use strict";var{isUtf8:br}=E("buffer"),wi=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Si(s){return s>=1e3&&s<=1014&&s!==1004&&s!==1005&&s!==1006||s>=3e3&&s<=4999}function ts(s){let e=s.length,t=0;for(;t<e;)if(!(s[t]&128))t++;else if((s[t]&224)===192){if(t+1===e||(s[t+1]&192)!==128||(s[t]&254)===192)return!1;t+=2}else if((s[t]&240)===224){if(t+2>=e||(s[t+1]&192)!==128||(s[t+2]&192)!==128||s[t]===224&&(s[t+1]&224)===128||s[t]===237&&(s[t+1]&224)===160)return!1;t+=3}else if((s[t]&248)===240){if(t+3>=e||(s[t+1]&192)!==128||(s[t+2]&192)!==128||(s[t+3]&192)!==128||s[t]===240&&(s[t+1]&240)===128||s[t]===244&&s[t+1]>143||s[t]>244)return!1;t+=4}else return!1;return!0}mt.exports={isValidStatusCode:Si,isValidUTF8:ts,tokenChars:wi};if(br)mt.exports.isValidUTF8=function(s){return s.length<24?ts(s):br(s)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let s=E("utf-8-validate");mt.exports.isValidUTF8=function(e){return e.length<32?ts(e):s(e)}}catch{}});var os=S((ic,Or)=>{"use strict";var{Writable:ki}=E("stream"),Er=We(),{BINARY_TYPES:Oi,EMPTY_BUFFER:xr,kStatusCode:Ti,kWebSocket:Fi}=ae(),{concat:ss,toArrayBuffer:Ni,unmask:Ri}=Ue(),{isValidStatusCode:Li,isValidUTF8:vr}=je(),gt=Buffer[Symbol.species],G=0,wr=1,Sr=2,kr=3,rs=4,ns=5,_t=6,is=class extends ki{constructor(e={}){super(),this._allowSynchronousEvents=e.allowSynchronousEvents!==void 0?e.allowSynchronousEvents:!0,this._binaryType=e.binaryType||Oi[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=e.maxPayload|0,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Fi]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=G}_write(e,t,r){if(this._opcode===8&&this._state==G)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=new gt(r.buffer,r.byteOffset+e,r.length-e),new gt(r.buffer,r.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=new gt(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case G:this.getInfo(e);break;case wr:this.getPayloadLength16(e);break;case Sr:this.getPayloadLength64(e);break;case kr:this.getMask();break;case rs:this.getData(e);break;case ns:case _t:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if(t[0]&48){let n=this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");e(n);return}let r=(t[0]&64)===64;if(r&&!this._extensions[Er.extensionName]){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._fin=(t[0]&128)===128,this._opcode=t[0]&15,this._payloadLength=t[1]&127,this._opcode===0){if(r){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(!this._fragmented){let n=this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented){let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}this._compressed=r}else if(this._opcode>7&&this._opcode<11){if(!this._fin){let n=this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");e(n);return}if(r){let n=this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");e(n);return}if(this._payloadLength>125||this._opcode===8&&this._payloadLength===1){let n=this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");e(n);return}}else{let n=this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");e(n);return}if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(t[1]&128)===128,this._isServer){if(!this._masked){let n=this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK");e(n);return}}else if(this._masked){let n=this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");e(n);return}this._payloadLength===126?this._state=wr:this._payloadLength===127?this._state=Sr:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);if(r>Math.pow(2,21)-1){let n=this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH");e(n);return}this._payloadLength=r*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){let t=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");e(t);return}this._masked?this._state=kr:this._state=rs}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=rs}getData(e){let t=xr;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3]&&Ri(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=ns,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[Er.extensionName].decompress(e,this._fin,(n,i)=>{if(n)return t(n);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0){let a=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");t(a);return}this._fragments.push(i)}this.dataMessage(t),this._state===G&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=G;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){let n;this._binaryType==="nodebuffer"?n=ss(r,t):this._binaryType==="arraybuffer"?n=Ni(ss(r,t)):n=r,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=G):(this._state=_t,setImmediate(()=>{this.emit("message",n,!0),this._state=G,this.startLoop(e)}))}else{let n=ss(r,t);if(!this._skipUTF8Validation&&!vr(n)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");e(i);return}this._state===ns||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=G):(this._state=_t,setImmediate(()=>{this.emit("message",n,!1),this._state=G,this.startLoop(e)}))}}controlMessage(e,t){if(this._opcode===8){if(e.length===0)this._loop=!1,this.emit("conclude",1005,xr),this.end();else{let r=e.readUInt16BE(0);if(!Li(r)){let i=this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");t(i);return}let n=new gt(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!vr(n)){let i=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");t(i);return}this._loop=!1,this.emit("conclude",r,n),this.end()}this._state=G;return}this._allowSynchronousEvents?(this.emit(this._opcode===9?"ping":"pong",e),this._state=G):(this._state=_t,setImmediate(()=>{this.emit(this._opcode===9?"ping":"pong",e),this._state=G,this.startLoop(t)}))}createError(e,t,r,n,i){this._loop=!1,this._errored=!0;let a=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(a,this.createError),a.code=i,a[Ti]=n,a}};Or.exports=is});var cs=S((ac,Nr)=>{"use strict";var{Duplex:oc}=E("stream"),{randomFillSync:Ai}=E("crypto"),Tr=We(),{EMPTY_BUFFER:Bi}=ae(),{isValidStatusCode:Pi}=je(),{mask:Fr,toBuffer:Ee}=Ue(),K=Symbol("kByteLength"),Di=Buffer.alloc(4),yt=8*1024,ue,xe=yt,as=class s{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r,n=!1,i=2,a=!1;t.mask&&(r=t.maskBuffer||Di,t.generateMask?t.generateMask(r):(xe===yt&&(ue===void 0&&(ue=Buffer.alloc(yt)),Ai(ue,0,yt),xe=0),r[0]=ue[xe++],r[1]=ue[xe++],r[2]=ue[xe++],r[3]=ue[xe++]),a=(r[0]|r[1]|r[2]|r[3])===0,i=6);let l;typeof e=="string"?(!t.mask||a)&&t[K]!==void 0?l=t[K]:(e=Buffer.from(e),l=e.length):(l=e.length,n=t.mask&&t.readOnly&&!a);let h=l;l>=65536?(i+=8,h=127):l>125&&(i+=2,h=126);let u=Buffer.allocUnsafe(n?l+i:i);return u[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(u[0]|=64),u[1]=h,h===126?u.writeUInt16BE(l,2):h===127&&(u[2]=u[3]=0,u.writeUIntBE(l,4,6)),t.mask?(u[1]|=128,u[i-4]=r[0],u[i-3]=r[1],u[i-2]=r[2],u[i-1]=r[3],a?[u,e]:n?(Fr(e,r,u,i,l),[u]):(Fr(e,r,e,0,l),[u,e])):[u,e]}close(e,t,r,n){let i;if(e===void 0)i=Bi;else{if(typeof e!="number"||!Pi(e))throw new TypeError("First argument must be a valid error code number");if(t===void 0||!t.length)i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0);else{let l=Buffer.byteLength(t);if(l>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+l),i.writeUInt16BE(e,0),typeof t=="string"?i.write(t,2):i.set(t,2)}}let a={[K]:i.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,i,!1,a,n]):this.sendFrame(s.frame(i,a),n)}ping(e,t,r){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):(e=Ee(e),n=e.length,i=Ee.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let a={[K]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,a,r]):this.sendFrame(s.frame(e,a),r)}pong(e,t,r){let n,i;if(typeof e=="string"?(n=Buffer.byteLength(e),i=!1):(e=Ee(e),n=e.length,i=Ee.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");let a={[K]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,a,r]):this.sendFrame(s.frame(e,a),r)}send(e,t,r){let n=this._extensions[Tr.extensionName],i=t.binary?2:1,a=t.compress,l,h;if(typeof e=="string"?(l=Buffer.byteLength(e),h=!1):(e=Ee(e),l=e.length,h=Ee.readOnly),this._firstFragment?(this._firstFragment=!1,a&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(a=l>=n._threshold),this._compress=a):(a=!1,i=0),t.fin&&(this._firstFragment=!0),n){let u={[K]:l,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:h,rsv1:a};this._deflating?this.enqueue([this.dispatch,e,this._compress,u,r]):this.dispatch(e,this._compress,u,r)}else this.sendFrame(s.frame(e,{[K]:l,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:i,readOnly:h,rsv1:!1}),r)}dispatch(e,t,r,n){if(!t){this.sendFrame(s.frame(e,r),n);return}let i=this._extensions[Tr.extensionName];this._bufferedBytes+=r[K],this._deflating=!0,i.compress(e,r.fin,(a,l)=>{if(this._socket.destroyed){let h=new Error("The socket was closed while data was being compressed");typeof n=="function"&&n(h);for(let u=0;u<this._queue.length;u++){let o=this._queue[u],c=o[o.length-1];typeof c=="function"&&c(h)}return}this._bufferedBytes-=r[K],this._deflating=!1,r.readOnly=!1,this.sendFrame(s.frame(l,r),n),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][K],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][K],this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};Nr.exports=as});var qr=S((cc,Ur)=>{"use strict";var{kForOnEventAttribute:Ve,kListener:ls}=ae(),Rr=Symbol("kCode"),Lr=Symbol("kData"),Ar=Symbol("kError"),Br=Symbol("kMessage"),Pr=Symbol("kReason"),ve=Symbol("kTarget"),Dr=Symbol("kType"),Ir=Symbol("kWasClean"),ne=class{constructor(e){this[ve]=null,this[Dr]=e}get target(){return this[ve]}get type(){return this[Dr]}};Object.defineProperty(ne.prototype,"target",{enumerable:!0});Object.defineProperty(ne.prototype,"type",{enumerable:!0});var de=class extends ne{constructor(e,t={}){super(e),this[Rr]=t.code===void 0?0:t.code,this[Pr]=t.reason===void 0?"":t.reason,this[Ir]=t.wasClean===void 0?!1:t.wasClean}get code(){return this[Rr]}get reason(){return this[Pr]}get wasClean(){return this[Ir]}};Object.defineProperty(de.prototype,"code",{enumerable:!0});Object.defineProperty(de.prototype,"reason",{enumerable:!0});Object.defineProperty(de.prototype,"wasClean",{enumerable:!0});var we=class extends ne{constructor(e,t={}){super(e),this[Ar]=t.error===void 0?null:t.error,this[Br]=t.message===void 0?"":t.message}get error(){return this[Ar]}get message(){return this[Br]}};Object.defineProperty(we.prototype,"error",{enumerable:!0});Object.defineProperty(we.prototype,"message",{enumerable:!0});var $e=class extends ne{constructor(e,t={}){super(e),this[Lr]=t.data===void 0?null:t.data}get data(){return this[Lr]}};Object.defineProperty($e.prototype,"data",{enumerable:!0});var Ii={addEventListener(s,e,t={}){for(let n of this.listeners(s))if(!t[Ve]&&n[ls]===e&&!n[Ve])return;let r;if(s==="message")r=function(i,a){let l=new $e("message",{data:a?i:i.toString()});l[ve]=this,Ct(e,this,l)};else if(s==="close")r=function(i,a){let l=new de("close",{code:i,reason:a.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});l[ve]=this,Ct(e,this,l)};else if(s==="error")r=function(i){let a=new we("error",{error:i,message:i.message});a[ve]=this,Ct(e,this,a)};else if(s==="open")r=function(){let i=new ne("open");i[ve]=this,Ct(e,this,i)};else return;r[Ve]=!!t[Ve],r[ls]=e,t.once?this.once(s,r):this.on(s,r)},removeEventListener(s,e){for(let t of this.listeners(s))if(t[ls]===e&&!t[Ve]){this.removeListener(s,t);break}}};Ur.exports={CloseEvent:de,ErrorEvent:we,Event:ne,EventTarget:Ii,MessageEvent:$e};function Ct(s,e,t){typeof s=="object"&&s.handleEvent?s.handleEvent.call(s,t):s.call(e,t)}});var fs=S((lc,Mr)=>{"use strict";var{tokenChars:He}=je();function Q(s,e,t){s[e]===void 0?s[e]=[t]:s[e].push(t)}function Ui(s){let e=Object.create(null),t=Object.create(null),r=!1,n=!1,i=!1,a,l,h=-1,u=-1,o=-1,c=0;for(;c<s.length;c++)if(u=s.charCodeAt(c),a===void 0)if(o===-1&&He[u]===1)h===-1&&(h=c);else if(c!==0&&(u===32||u===9))o===-1&&h!==-1&&(o=c);else if(u===59||u===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${c}`);o===-1&&(o=c);let _=s.slice(h,o);u===44?(Q(e,_,t),t=Object.create(null)):a=_,h=o=-1}else throw new SyntaxError(`Unexpected character at index ${c}`);else if(l===void 0)if(o===-1&&He[u]===1)h===-1&&(h=c);else if(u===32||u===9)o===-1&&h!==-1&&(o=c);else if(u===59||u===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${c}`);o===-1&&(o=c),Q(t,s.slice(h,o),!0),u===44&&(Q(e,a,t),t=Object.create(null),a=void 0),h=o=-1}else if(u===61&&h!==-1&&o===-1)l=s.slice(h,c),h=o=-1;else throw new SyntaxError(`Unexpected character at index ${c}`);else if(n){if(He[u]!==1)throw new SyntaxError(`Unexpected character at index ${c}`);h===-1?h=c:r||(r=!0),n=!1}else if(i)if(He[u]===1)h===-1&&(h=c);else if(u===34&&h!==-1)i=!1,o=c;else if(u===92)n=!0;else throw new SyntaxError(`Unexpected character at index ${c}`);else if(u===34&&s.charCodeAt(c-1)===61)i=!0;else if(o===-1&&He[u]===1)h===-1&&(h=c);else if(h!==-1&&(u===32||u===9))o===-1&&(o=c);else if(u===59||u===44){if(h===-1)throw new SyntaxError(`Unexpected character at index ${c}`);o===-1&&(o=c);let _=s.slice(h,o);r&&(_=_.replace(/\\/g,""),r=!1),Q(t,l,_),u===44&&(Q(e,a,t),t=Object.create(null),a=void 0),l=void 0,h=o=-1}else throw new SyntaxError(`Unexpected character at index ${c}`);if(h===-1||i||u===32||u===9)throw new SyntaxError("Unexpected end of input");o===-1&&(o=c);let f=s.slice(h,o);return a===void 0?Q(e,f,t):(l===void 0?Q(t,f,!0):r?Q(t,l,f.replace(/\\/g,"")):Q(t,l,f),Q(e,a,t)),e}function qi(s){return Object.keys(s).map(e=>{let t=s[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(n=>{let i=r[n];return Array.isArray(i)||(i=[i]),i.map(a=>a===!0?n:`${n}=${a}`).join("; ")})).join("; ")).join(", ")}).join(", ")}Mr.exports={format:qi,parse:Ui}});var ms=S((uc,Jr)=>{"use strict";var Mi=E("events"),Wi=E("https"),ji=E("http"),Vr=E("net"),Vi=E("tls"),{randomBytes:$i,createHash:Hi}=E("crypto"),{Duplex:fc,Readable:hc}=E("stream"),{URL:hs}=E("url"),le=We(),Gi=os(),zi=cs(),{BINARY_TYPES:Wr,EMPTY_BUFFER:bt,GUID:Xi,kForOnEventAttribute:us,kListener:Yi,kStatusCode:Ki,kWebSocket:D,NOOP:$r}=ae(),{EventTarget:{addEventListener:Ji,removeEventListener:Qi}}=qr(),{format:Zi,parse:eo}=fs(),{toBuffer:to}=Ue(),so=30*1e3,Hr=Symbol("kAborted"),ds=[8,13],ie=["CONNECTING","OPEN","CLOSING","CLOSED"],ro=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,O=class s extends Mi{constructor(e,t,r){super(),this._binaryType=Wr[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=bt,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=s.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,t===void 0?t=[]:Array.isArray(t)||(typeof t=="object"&&t!==null?(r=t,t=[]):t=[t]),Gr(this,e,t,r)):(this._autoPong=r.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){Wr.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let n=new Gi({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new zi(e,this._extensions,r.generateMask),this._receiver=n,this._socket=e,n[D]=this,e[D]=this,n.on("conclude",oo),n.on("drain",ao),n.on("error",co),n.on("message",lo),n.on("ping",fo),n.on("pong",ho),e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Xr),e.on("data",xt),e.on("end",Yr),e.on("error",Kr),this._readyState=s.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=s.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[le.extensionName]&&this._extensions[le.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=s.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==s.CLOSED){if(this.readyState===s.CONNECTING){j(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===s.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=s.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),so)}}pause(){this.readyState===s.CONNECTING||this.readyState===s.CLOSED||(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===s.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==s.OPEN){ps(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.ping(e||bt,t,r)}pong(e,t,r){if(this.readyState===s.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),typeof e=="number"&&(e=e.toString()),this.readyState!==s.OPEN){ps(this,e,r);return}t===void 0&&(t=!this._isServer),this._sender.pong(e||bt,t,r)}resume(){this.readyState===s.CONNECTING||this.readyState===s.CLOSED||(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===s.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if(typeof t=="function"&&(r=t,t={}),typeof e=="number"&&(e=e.toString()),this.readyState!==s.OPEN){ps(this,e,r);return}let n=M({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[le.extensionName]||(n.compress=!1),this._sender.send(e||bt,n,r)}terminate(){if(this.readyState!==s.CLOSED){if(this.readyState===s.CONNECTING){j(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=s.CLOSING,this._socket.destroy())}}};Object.defineProperty(O,"CONNECTING",{enumerable:!0,value:ie.indexOf("CONNECTING")});Object.defineProperty(O.prototype,"CONNECTING",{enumerable:!0,value:ie.indexOf("CONNECTING")});Object.defineProperty(O,"OPEN",{enumerable:!0,value:ie.indexOf("OPEN")});Object.defineProperty(O.prototype,"OPEN",{enumerable:!0,value:ie.indexOf("OPEN")});Object.defineProperty(O,"CLOSING",{enumerable:!0,value:ie.indexOf("CLOSING")});Object.defineProperty(O.prototype,"CLOSING",{enumerable:!0,value:ie.indexOf("CLOSING")});Object.defineProperty(O,"CLOSED",{enumerable:!0,value:ie.indexOf("CLOSED")});Object.defineProperty(O.prototype,"CLOSED",{enumerable:!0,value:ie.indexOf("CLOSED")});["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(s=>{Object.defineProperty(O.prototype,s,{enumerable:!0})});["open","error","close","message"].forEach(s=>{Object.defineProperty(O.prototype,`on${s}`,{enumerable:!0,get(){for(let e of this.listeners(s))if(e[us])return e[Yi];return null},set(e){for(let t of this.listeners(s))if(t[us]){this.removeListener(s,t);break}typeof e=="function"&&this.addEventListener(s,e,{[us]:!0})}})});O.prototype.addEventListener=Ji;O.prototype.removeEventListener=Qi;Jr.exports=O;function Gr(s,e,t,r){let n=Z(M({allowSynchronousEvents:!0,autoPong:!0,protocolVersion:ds[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},r),{socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0});if(s._autoPong=n.autoPong,!ds.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${ds.join(", ")})`);let i;if(e instanceof hs)i=e;else try{i=new hs(e)}catch{throw new SyntaxError(`Invalid URL: ${e}`)}i.protocol==="http:"?i.protocol="ws:":i.protocol==="https:"&&(i.protocol="wss:"),s._url=i.href;let a=i.protocol==="wss:",l=i.protocol==="ws+unix:",h;if(i.protocol!=="ws:"&&!a&&!l?h=`The URL's protocol must be one of "ws:", "wss:", "http:", "https", or "ws+unix:"`:l&&!i.pathname?h="The URL's pathname is empty":i.hash&&(h="The URL contains a fragment identifier"),h){let d=new SyntaxError(h);if(s._redirects===0)throw d;Et(s,d);return}let u=a?443:80,o=$i(16).toString("base64"),c=a?Wi.request:ji.request,f=new Set,_;if(n.createConnection=n.createConnection||(a?io:no),n.defaultPort=n.defaultPort||u,n.port=i.port||u,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers=Z(M({},n.headers),{"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":o,Connection:"Upgrade",Upgrade:"websocket"}),n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(_=new le(n.perMessageDeflate!==!0?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=Zi({[le.extensionName]:_.offer()})),t.length){for(let d of t){if(typeof d!="string"||!ro.test(d)||f.has(d))throw new SyntaxError("An invalid or duplicated subprotocol was specified");f.add(d)}n.headers["Sec-WebSocket-Protocol"]=t.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),l){let d=n.path.split(":");n.socketPath=d[0],n.path=d[1]}let y;if(n.followRedirects){if(s._redirects===0){s._originalIpc=l,s._originalSecure=a,s._originalHostOrSocketPath=l?n.socketPath:i.host;let d=r&&r.headers;if(r=Z(M({},r),{headers:{}}),d)for(let[m,b]of Object.entries(d))r.headers[m.toLowerCase()]=b}else if(s.listenerCount("redirect")===0){let d=l?s._originalIpc?n.socketPath===s._originalHostOrSocketPath:!1:s._originalIpc?!1:i.host===s._originalHostOrSocketPath;(!d||s._originalSecure&&!a)&&(delete n.headers.authorization,delete n.headers.cookie,d||delete n.headers.host,n.auth=void 0)}n.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+Buffer.from(n.auth).toString("base64")),y=s._req=c(n),s._redirects&&s.emit("redirect",s.url,y)}else y=s._req=c(n);n.timeout&&y.on("timeout",()=>{j(s,y,"Opening handshake has timed out")}),y.on("error",d=>{y===null||y[Hr]||(y=s._req=null,Et(s,d))}),y.on("response",d=>{let m=d.headers.location,b=d.statusCode;if(m&&n.followRedirects&&b>=300&&b<400){if(++s._redirects>n.maxRedirects){j(s,y,"Maximum redirects exceeded");return}y.abort();let x;try{x=new hs(m,e)}catch{let g=new SyntaxError(`Invalid URL: ${m}`);Et(s,g);return}Gr(s,x,t,r)}else s.emit("unexpected-response",y,d)||j(s,y,`Unexpected server response: ${d.statusCode}`)}),y.on("upgrade",(d,m,b)=>{if(s.emit("upgrade",d),s.readyState!==O.CONNECTING)return;y=s._req=null;let x=d.headers.upgrade;if(x===void 0||x.toLowerCase()!=="websocket"){j(s,m,"Invalid Upgrade header");return}let p=Hi("sha1").update(o+Xi).digest("base64");if(d.headers["sec-websocket-accept"]!==p){j(s,m,"Invalid Sec-WebSocket-Accept header");return}let g=d.headers["sec-websocket-protocol"],F;if(g!==void 0?f.size?f.has(g)||(F="Server sent an invalid subprotocol"):F="Server sent a subprotocol but none was requested":f.size&&(F="Server sent no subprotocol"),F){j(s,m,F);return}g&&(s._protocol=g);let w=d.headers["sec-websocket-extensions"];if(w!==void 0){if(!_){j(s,m,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}let A;try{A=eo(w)}catch{j(s,m,"Invalid Sec-WebSocket-Extensions header");return}let I=Object.keys(A);if(I.length!==1||I[0]!==le.extensionName){j(s,m,"Server indicated an extension that was not requested");return}try{_.accept(A[le.extensionName])}catch{j(s,m,"Invalid Sec-WebSocket-Extensions header");return}s._extensions[le.extensionName]=_}s.setSocket(m,b,{allowSynchronousEvents:n.allowSynchronousEvents,generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}),n.finishRequest?n.finishRequest(y,s):y.end()}function Et(s,e){s._readyState=O.CLOSING,s.emit("error",e),s.emitClose()}function no(s){return s.path=s.socketPath,Vr.connect(s)}function io(s){return s.path=void 0,!s.servername&&s.servername!==""&&(s.servername=Vr.isIP(s.host)?"":s.host),Vi.connect(s)}function j(s,e,t){s._readyState=O.CLOSING;let r=new Error(t);Error.captureStackTrace(r,j),e.setHeader?(e[Hr]=!0,e.abort(),e.socket&&!e.socket.destroyed&&e.socket.destroy(),process.nextTick(Et,s,r)):(e.destroy(r),e.once("error",s.emit.bind(s,"error")),e.once("close",s.emitClose.bind(s)))}function ps(s,e,t){if(e){let r=to(e).length;s._socket?s._sender._bufferedBytes+=r:s._bufferedAmount+=r}if(t){let r=new Error(`WebSocket is not open: readyState ${s.readyState} (${ie[s.readyState]})`);process.nextTick(t,r)}}function oo(s,e){let t=this[D];t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=s,t._socket[D]!==void 0&&(t._socket.removeListener("data",xt),process.nextTick(zr,t._socket),s===1005?t.close():t.close(s,e))}function ao(){let s=this[D];s.isPaused||s._socket.resume()}function co(s){let e=this[D];e._socket[D]!==void 0&&(e._socket.removeListener("data",xt),process.nextTick(zr,e._socket),e.close(s[Ki])),e.emit("error",s)}function jr(){this[D].emitClose()}function lo(s,e){this[D].emit("message",s,e)}function fo(s){let e=this[D];e._autoPong&&e.pong(s,!this._isServer,$r),e.emit("ping",s)}function ho(s){this[D].emit("pong",s)}function zr(s){s.resume()}function Xr(){let s=this[D];this.removeListener("close",Xr),this.removeListener("data",xt),this.removeListener("end",Yr),s._readyState=O.CLOSING;let e;!this._readableState.endEmitted&&!s._closeFrameReceived&&!s._receiver._writableState.errorEmitted&&(e=s._socket.read())!==null&&s._receiver.write(e),s._receiver.end(),this[D]=void 0,clearTimeout(s._closeTimer),s._receiver._writableState.finished||s._receiver._writableState.errorEmitted?s.emitClose():(s._receiver.on("error",jr),s._receiver.on("finish",jr))}function xt(s){this[D]._receiver.write(s)||this.pause()}function Yr(){let s=this[D];s._readyState=O.CLOSING,s._receiver.end(),this.end()}function Kr(){let s=this[D];this.removeListener("error",Kr),this.on("error",$r),s&&(s._readyState=O.CLOSING,this.destroy())}});var Zr=S((pc,Qr)=>{"use strict";var{tokenChars:uo}=je();function po(s){let e=new Set,t=-1,r=-1,n=0;for(n;n<s.length;n++){let a=s.charCodeAt(n);if(r===-1&&uo[a]===1)t===-1&&(t=n);else if(n!==0&&(a===32||a===9))r===-1&&t!==-1&&(r=n);else if(a===44){if(t===-1)throw new SyntaxError(`Unexpected character at index ${n}`);r===-1&&(r=n);let l=s.slice(t,r);if(e.has(l))throw new SyntaxError(`The "${l}" subprotocol is duplicated`);e.add(l),t=r=-1}else throw new SyntaxError(`Unexpected character at index ${n}`)}if(t===-1||r!==-1)throw new SyntaxError("Unexpected end of input");let i=s.slice(t,n);if(e.has(i))throw new SyntaxError(`The "${i}" subprotocol is duplicated`);return e.add(i),e}Qr.exports={parse:po}});var an=S((gc,on)=>{"use strict";var mo=E("events"),vt=E("http"),{Duplex:mc}=E("stream"),{createHash:go}=E("crypto"),en=fs(),pe=We(),_o=Zr(),yo=ms(),{GUID:Co,kWebSocket:bo}=ae(),Eo=/^[+/0-9A-Za-z]{22}==$/,tn=0,sn=1,nn=2,gs=class extends mo{constructor(e,t){if(super(),e=M({allowSynchronousEvents:!0,autoPong:!0,maxPayload:100*1024*1024,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:yo},e),e.port==null&&!e.server&&!e.noServer||e.port!=null&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(e.port!=null?(this._server=vt.createServer((r,n)=>{let i=vt.STATUS_CODES[426];n.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),n.end(i)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let r=this.emit.bind(this,"connection");this._removeListeners=xo(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(n,i,a)=>{this.handleUpgrade(n,i,a,r)}})}e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=tn}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this._state===nn){e&&this.once("close",()=>{e(new Error("The server is not running"))}),process.nextTick(Ge,this);return}if(e&&this.once("close",e),this._state!==sn)if(this._state=sn,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients?this.clients.size?this._shouldEmitClose=!0:process.nextTick(Ge,this):process.nextTick(Ge,this);else{let t=this._server;this._removeListeners(),this._removeListeners=this._server=null,t.close(()=>{Ge(this)})}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,n){t.on("error",rn);let i=e.headers["sec-websocket-key"],a=e.headers.upgrade,l=+e.headers["sec-websocket-version"];if(e.method!=="GET"){me(this,e,t,405,"Invalid HTTP method");return}if(a===void 0||a.toLowerCase()!=="websocket"){me(this,e,t,400,"Invalid Upgrade header");return}if(i===void 0||!Eo.test(i)){me(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(l!==8&&l!==13){me(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header");return}if(!this.shouldHandle(e)){ze(t,400);return}let h=e.headers["sec-websocket-protocol"],u=new Set;if(h!==void 0)try{u=_o.parse(h)}catch{me(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let o=e.headers["sec-websocket-extensions"],c={};if(this.options.perMessageDeflate&&o!==void 0){let f=new pe(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let _=en.parse(o);_[pe.extensionName]&&(f.accept(_[pe.extensionName]),c[pe.extensionName]=f)}catch{me(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let f={origin:e.headers[`${l===8?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(f,(_,y,d,m)=>{if(!_)return ze(t,y||401,d,m);this.completeUpgrade(c,i,u,e,t,r,n)});return}if(!this.options.verifyClient(f))return ze(t,401)}this.completeUpgrade(c,i,u,e,t,r,n)}completeUpgrade(e,t,r,n,i,a,l){if(!i.readable||!i.writable)return i.destroy();if(i[bo])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>tn)return ze(i,503);let u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${go("sha1").update(t+Co).digest("base64")}`],o=new this.options.WebSocket(null,void 0,this.options);if(r.size){let c=this.options.handleProtocols?this.options.handleProtocols(r,n):r.values().next().value;c&&(u.push(`Sec-WebSocket-Protocol: ${c}`),o._protocol=c)}if(e[pe.extensionName]){let c=e[pe.extensionName].params,f=en.format({[pe.extensionName]:[c]});u.push(`Sec-WebSocket-Extensions: ${f}`),o._extensions=e}this.emit("headers",u,n),i.write(u.concat(`\r
`).join(`\r
`)),i.removeListener("error",rn),o.setSocket(i,a,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(o),o.on("close",()=>{this.clients.delete(o),this._shouldEmitClose&&!this.clients.size&&process.nextTick(Ge,this)})),l(o,n)}};on.exports=gs;function xo(s,e){for(let t of Object.keys(e))s.on(t,e[t]);return function(){for(let r of Object.keys(e))s.removeListener(r,e[r])}}function Ge(s){s._state=nn,s.emit("close")}function rn(){this.destroy()}function ze(s,e,t,r){t=t||vt.STATUS_CODES[e],r=M({Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(t)},r),s.once("finish",s.destroy),s.end(`HTTP/1.1 ${e} ${vt.STATUS_CODES[e]}\r
`+Object.keys(r).map(n=>`${n}: ${r[n]}`).join(`\r
`)+`\r
\r
`+t)}function me(s,e,t,r,n){if(s.listenerCount("wsClientError")){let i=new Error(n);Error.captureStackTrace(i,me),s.emit("wsClientError",i,t,e)}else ze(t,r,n)}});var Es=S((il,un)=>{"use strict";function Ao(s){t.debug=t,t.default=t,t.coerce=h,t.disable=i,t.enable=n,t.enabled=a,t.humanize=qt(),t.destroy=u,Object.keys(s).forEach(o=>{t[o]=s[o]}),t.names=[],t.skips=[],t.formatters={};function e(o){let c=0;for(let f=0;f<o.length;f++)c=(c<<5)-c+o.charCodeAt(f),c|=0;return t.colors[Math.abs(c)%t.colors.length]}t.selectColor=e;function t(o){let c,f=null,_,y;function d(...m){if(!d.enabled)return;let b=d,x=Number(new Date),p=x-(c||x);b.diff=p,b.prev=c,b.curr=x,c=x,m[0]=t.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let g=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(w,A)=>{if(w==="%%")return"%";g++;let I=t.formatters[A];if(typeof I=="function"){let z=m[g];w=I.call(b,z),m.splice(g,1),g--}return w}),t.formatArgs.call(b,m),(b.log||t.log).apply(b,m)}return d.namespace=o,d.useColors=t.useColors(),d.color=t.selectColor(o),d.extend=r,d.destroy=t.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(_!==t.namespaces&&(_=t.namespaces,y=t.enabled(o)),y),set:m=>{f=m}}),typeof t.init=="function"&&t.init(d),d}function r(o,c){let f=t(this.namespace+(typeof c>"u"?":":c)+o);return f.log=this.log,f}function n(o){t.save(o),t.namespaces=o,t.names=[],t.skips=[];let c,f=(typeof o=="string"?o:"").split(/[\s,]+/),_=f.length;for(c=0;c<_;c++)f[c]&&(o=f[c].replace(/\*/g,".*?"),o[0]==="-"?t.skips.push(new RegExp("^"+o.slice(1)+"$")):t.names.push(new RegExp("^"+o+"$")))}function i(){let o=[...t.names.map(l),...t.skips.map(l).map(c=>"-"+c)].join(",");return t.enable(""),o}function a(o){if(o[o.length-1]==="*")return!0;let c,f;for(c=0,f=t.skips.length;c<f;c++)if(t.skips[c].test(o))return!1;for(c=0,f=t.names.length;c<f;c++)if(t.names[c].test(o))return!0;return!1}function l(o){return o.toString().substring(2,o.toString().length-2).replace(/\.\*\?$/,"*")}function h(o){return o instanceof Error?o.stack||o.message:o}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}un.exports=Ao});var dn=S((V,Tt)=>{"use strict";V.formatArgs=Po;V.save=Do;V.load=Io;V.useColors=Bo;V.storage=Uo();V.destroy=(()=>{let s=!1;return()=>{s||(s=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();V.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Bo(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let s;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(s=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(s[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Po(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+Tt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;s.splice(1,0,e,"color: inherit");let t=0,r=0;s[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(t++,n==="%c"&&(r=t))}),s.splice(r,0,e)}V.log=console.debug||console.log||(()=>{});function Do(s){try{s?V.storage.setItem("debug",s):V.storage.removeItem("debug")}catch{}}function Io(){let s;try{s=V.storage.getItem("debug")}catch{}return!s&&typeof process<"u"&&"env"in process&&(s=process.env.DEBUG),s}function Uo(){try{return localStorage}catch{}}Tt.exports=Es()(V);var{formatters:qo}=Tt.exports;qo.j=function(s){try{return JSON.stringify(s)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var mn=S((R,Nt)=>{"use strict";var Mo=E("tty"),Ft=E("util");R.init=zo;R.log=$o;R.formatArgs=jo;R.save=Ho;R.load=Go;R.useColors=Wo;R.destroy=Ft.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");R.colors=[6,2,3,4,5,1];try{let s=Mt();s&&(s.stderr||s).level>=2&&(R.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}R.inspectOpts=Object.keys(process.env).filter(s=>/^debug_/i.test(s)).reduce((s,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),s[t]=r,s},{});function Wo(){return"colors"in R.inspectOpts?!!R.inspectOpts.colors:Mo.isatty(process.stderr.fd)}function jo(s){let{namespace:e,useColors:t}=this;if(t){let r=this.color,n="\x1B[3"+(r<8?r:"8;5;"+r),i=`  ${n};1m${e} \x1B[0m`;s[0]=i+s[0].split(`
`).join(`
`+i),s.push(n+"m+"+Nt.exports.humanize(this.diff)+"\x1B[0m")}else s[0]=Vo()+e+" "+s[0]}function Vo(){return R.inspectOpts.hideDate?"":new Date().toISOString()+" "}function $o(...s){return process.stderr.write(Ft.formatWithOptions(R.inspectOpts,...s)+`
`)}function Ho(s){s?process.env.DEBUG=s:delete process.env.DEBUG}function Go(){return process.env.DEBUG}function zo(s){s.inspectOpts={};let e=Object.keys(R.inspectOpts);for(let t=0;t<e.length;t++)s.inspectOpts[e[t]]=R.inspectOpts[e[t]]}Nt.exports=Es()(R);var{formatters:pn}=Nt.exports;pn.o=function(s){return this.inspectOpts.colors=this.useColors,Ft.inspect(s,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};pn.O=function(s){return this.inspectOpts.colors=this.useColors,Ft.inspect(s,this.inspectOpts)}});var Je=S((ol,xs)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?xs.exports=dn():xs.exports=mn()});var Ss=S((ul,xn)=>{"use strict";function Qo(s){t.debug=t,t.default=t,t.coerce=h,t.disable=i,t.enable=n,t.enabled=a,t.humanize=qt(),t.destroy=u,Object.keys(s).forEach(o=>{t[o]=s[o]}),t.names=[],t.skips=[],t.formatters={};function e(o){let c=0;for(let f=0;f<o.length;f++)c=(c<<5)-c+o.charCodeAt(f),c|=0;return t.colors[Math.abs(c)%t.colors.length]}t.selectColor=e;function t(o){let c,f=null,_,y;function d(...m){if(!d.enabled)return;let b=d,x=Number(new Date),p=x-(c||x);b.diff=p,b.prev=c,b.curr=x,c=x,m[0]=t.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let g=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(w,A)=>{if(w==="%%")return"%";g++;let I=t.formatters[A];if(typeof I=="function"){let z=m[g];w=I.call(b,z),m.splice(g,1),g--}return w}),t.formatArgs.call(b,m),(b.log||t.log).apply(b,m)}return d.namespace=o,d.useColors=t.useColors(),d.color=t.selectColor(o),d.extend=r,d.destroy=t.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(_!==t.namespaces&&(_=t.namespaces,y=t.enabled(o)),y),set:m=>{f=m}}),typeof t.init=="function"&&t.init(d),d}function r(o,c){let f=t(this.namespace+(typeof c>"u"?":":c)+o);return f.log=this.log,f}function n(o){t.save(o),t.namespaces=o,t.names=[],t.skips=[];let c,f=(typeof o=="string"?o:"").split(/[\s,]+/),_=f.length;for(c=0;c<_;c++)f[c]&&(o=f[c].replace(/\*/g,".*?"),o[0]==="-"?t.skips.push(new RegExp("^"+o.slice(1)+"$")):t.names.push(new RegExp("^"+o+"$")))}function i(){let o=[...t.names.map(l),...t.skips.map(l).map(c=>"-"+c)].join(",");return t.enable(""),o}function a(o){if(o[o.length-1]==="*")return!0;let c,f;for(c=0,f=t.skips.length;c<f;c++)if(t.skips[c].test(o))return!1;for(c=0,f=t.names.length;c<f;c++)if(t.names[c].test(o))return!0;return!1}function l(o){return o.toString().substring(2,o.toString().length-2).replace(/\.\*\?$/,"*")}function h(o){return o instanceof Error?o.stack||o.message:o}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}xn.exports=Qo});var vn=S(($,Rt)=>{"use strict";$.formatArgs=ea;$.save=ta;$.load=sa;$.useColors=Zo;$.storage=ra();$.destroy=(()=>{let s=!1;return()=>{s||(s=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();$.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Zo(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let s;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(s=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(s[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ea(s){if(s[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+s[0]+(this.useColors?"%c ":" ")+"+"+Rt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;s.splice(1,0,e,"color: inherit");let t=0,r=0;s[0].replace(/%[a-zA-Z%]/g,n=>{n!=="%%"&&(t++,n==="%c"&&(r=t))}),s.splice(r,0,e)}$.log=console.debug||console.log||(()=>{});function ta(s){try{s?$.storage.setItem("debug",s):$.storage.removeItem("debug")}catch{}}function sa(){let s;try{s=$.storage.getItem("debug")}catch{}return!s&&typeof process<"u"&&"env"in process&&(s=process.env.DEBUG),s}function ra(){try{return localStorage}catch{}}Rt.exports=Ss()($);var{formatters:na}=Rt.exports;na.j=function(s){try{return JSON.stringify(s)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Sn=S((L,At)=>{"use strict";var ia=E("tty"),Lt=E("util");L.init=ua;L.log=la;L.formatArgs=aa;L.save=fa;L.load=ha;L.useColors=oa;L.destroy=Lt.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");L.colors=[6,2,3,4,5,1];try{let s=Mt();s&&(s.stderr||s).level>=2&&(L.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}L.inspectOpts=Object.keys(process.env).filter(s=>/^debug_/i.test(s)).reduce((s,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(n,i)=>i.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),s[t]=r,s},{});function oa(){return"colors"in L.inspectOpts?!!L.inspectOpts.colors:ia.isatty(process.stderr.fd)}function aa(s){let{namespace:e,useColors:t}=this;if(t){let r=this.color,n="\x1B[3"+(r<8?r:"8;5;"+r),i=`  ${n};1m${e} \x1B[0m`;s[0]=i+s[0].split(`
`).join(`
`+i),s.push(n+"m+"+At.exports.humanize(this.diff)+"\x1B[0m")}else s[0]=ca()+e+" "+s[0]}function ca(){return L.inspectOpts.hideDate?"":new Date().toISOString()+" "}function la(...s){return process.stderr.write(Lt.formatWithOptions(L.inspectOpts,...s)+`
`)}function fa(s){s?process.env.DEBUG=s:delete process.env.DEBUG}function ha(){return process.env.DEBUG}function ua(s){s.inspectOpts={};let e=Object.keys(L.inspectOpts);for(let t=0;t<e.length;t++)s.inspectOpts[e[t]]=L.inspectOpts[e[t]]}At.exports=Ss()(L);var{formatters:wn}=At.exports;wn.o=function(s){return this.inspectOpts.colors=this.useColors,Lt.inspect(s,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};wn.O=function(s){return this.inspectOpts.colors=this.useColors,Lt.inspect(s,this.inspectOpts)}});var kn=S((dl,ks)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?ks.exports=vn():ks.exports=Sn()});var Yt=B(Ps(),1);var X=Object.create(null);X.open="0";X.close="1";X.ping="2";X.pong="3";X.message="4";X.upgrade="5";X.noop="6";var Ae=Object.create(null);Object.keys(X).forEach(s=>{Ae[X[s]]=s});var Be={type:"error",data:"parser error"};var Pe=({type:s,data:e},t,r)=>e instanceof ArrayBuffer||ArrayBuffer.isView(e)?r(t?e:"b"+Ds(e,!0).toString("base64")):r(X[s]+(e||"")),Ds=(s,e)=>Buffer.isBuffer(s)||s instanceof Uint8Array&&!e?s:s instanceof ArrayBuffer?Buffer.from(s):Buffer.from(s.buffer,s.byteOffset,s.byteLength),jt;function Is(s,e){if(s.data instanceof ArrayBuffer||ArrayBuffer.isView(s.data))return e(Ds(s.data,!1));Pe(s,!0,t=>{jt||(jt=new TextEncoder),e(jt.encode(t))})}var De=(s,e)=>{if(typeof s!="string")return{type:"message",data:Us(s,e)};let t=s.charAt(0);if(t==="b"){let r=Buffer.from(s.substring(1),"base64");return{type:"message",data:Us(r,e)}}return Ae[t]?s.length>1?{type:Ae[t],data:s.substring(1)}:{type:Ae[t]}:Be},Us=(s,e)=>{switch(e){case"arraybuffer":return s instanceof ArrayBuffer?s:Buffer.isBuffer(s)?s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength):s.buffer;case"nodebuffer":default:return Buffer.isBuffer(s)?s:Buffer.from(s)}};var qs="",Ms=(s,e)=>{let t=s.length,r=new Array(t),n=0;s.forEach((i,a)=>{Pe(i,!1,l=>{r[a]=l,++n===t&&e(r.join(qs))})})},Ws=(s,e)=>{let t=s.split(qs),r=[];for(let n=0;n<t.length;n++){let i=De(t[n],e);if(r.push(i),i.type==="error")break}return r};function js(){return new TransformStream({transform(s,e){Is(s,t=>{let r=t.length,n;if(r<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,r);else if(r<65536){n=new Uint8Array(3);let i=new DataView(n.buffer);i.setUint8(0,126),i.setUint16(1,r)}else{n=new Uint8Array(9);let i=new DataView(n.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(r))}s.data&&typeof s.data!="string"&&(n[0]|=128),e.enqueue(n),e.enqueue(t)})}})}var Vt;function st(s){return s.reduce((e,t)=>e+t.length,0)}function rt(s,e){if(s[0].length===e)return s.shift();let t=new Uint8Array(e),r=0;for(let n=0;n<e;n++)t[n]=s[0][r++],r===s[0].length&&(s.shift(),r=0);return s.length&&r<s[0].length&&(s[0]=s[0].slice(r)),t}function Vs(s,e){Vt||(Vt=new TextDecoder);let t=[],r=0,n=-1,i=!1;return new TransformStream({transform(a,l){for(t.push(a);;){if(r===0){if(st(t)<1)break;let h=rt(t,1);i=(h[0]&128)===128,n=h[0]&127,n<126?r=3:n===126?r=1:r=2}else if(r===1){if(st(t)<2)break;let h=rt(t,2);n=new DataView(h.buffer,h.byteOffset,h.length).getUint16(0),r=3}else if(r===2){if(st(t)<8)break;let h=rt(t,8),u=new DataView(h.buffer,h.byteOffset,h.length),o=u.getUint32(0);if(o>Math.pow(2,21)-1){l.enqueue(Be);break}n=o*Math.pow(2,32)+u.getUint32(4),r=3}else{if(st(t)<n)break;let h=rt(t,n);l.enqueue(De(i?h:Vt.decode(h),e)),r=0}if(n===0||n>s){l.enqueue(Be);break}}}})}var $t=4;function k(s){if(s)return jn(s)}function jn(s){for(var e in k.prototype)s[e]=k.prototype[e];return s}k.prototype.on=k.prototype.addEventListener=function(s,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+s]=this._callbacks["$"+s]||[]).push(e),this};k.prototype.once=function(s,e){function t(){this.off(s,t),e.apply(this,arguments)}return t.fn=e,this.on(s,t),this};k.prototype.off=k.prototype.removeListener=k.prototype.removeAllListeners=k.prototype.removeEventListener=function(s,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+s];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+s],this;for(var r,n=0;n<t.length;n++)if(r=t[n],r===e||r.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+s],this};k.prototype.emit=function(s){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+s],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,n=t.length;r<n;++r)t[r].apply(this,e)}return this};k.prototype.emitReserved=k.prototype.emit;k.prototype.listeners=function(s){return this._callbacks=this._callbacks||{},this._callbacks["$"+s]||[]};k.prototype.hasListeners=function(s){return!!this.listeners(s).length};var ee=process.nextTick,q=global,$s="nodebuffer";function Hs(){return new Ht}function Vn(s){let e=s.split("; "),t=e[0].indexOf("=");if(t===-1)return;let r=e[0].substring(0,t).trim();if(!r.length)return;let n=e[0].substring(t+1).trim();n.charCodeAt(0)===34&&(n=n.slice(1,-1));let i={name:r,value:n};for(let a=1;a<e.length;a++){let l=e[a].split("=");if(l.length!==2)continue;let h=l[0].trim(),u=l[1].trim();switch(h){case"Expires":i.expires=new Date(u);break;case"Max-Age":let o=new Date;o.setUTCSeconds(o.getUTCSeconds()+parseInt(u,10)),i.expires=o;break;default:}}return i}var Ht=class{constructor(){this._cookies=new Map}parseCookies(e){e&&e.forEach(t=>{let r=Vn(t);r&&this._cookies.set(r.name,r)})}get cookies(){let e=Date.now();return this._cookies.forEach((t,r)=>{var n;((n=t.expires)===null||n===void 0?void 0:n.getTime())<e&&this._cookies.delete(r)}),this._cookies.entries()}addCookies(e){let t=[];for(let[r,n]of this.cookies)t.push(`${r}=${n.value}`);t.length&&(e.setDisableHeaderCheck(!0),e.setRequestHeader("cookie",t.join("; ")))}appendCookies(e){for(let[t,r]of this.cookies)e.append("cookie",`${t}=${r.value}`)}};function nt(s,...e){return e.reduce((t,r)=>(s.hasOwnProperty(r)&&(t[r]=s[r]),t),{})}var $n=q.setTimeout,Hn=q.clearTimeout;function te(s,e){e.useNativeTimers?(s.setTimeoutFn=$n.bind(q),s.clearTimeoutFn=Hn.bind(q)):(s.setTimeoutFn=q.setTimeout.bind(q),s.clearTimeoutFn=q.clearTimeout.bind(q))}var Gn=1.33;function Gs(s){return typeof s=="string"?zn(s):Math.ceil((s.byteLength||s.size)*Gn)}function zn(s){let e=0,t=0;for(let r=0,n=s.length;r<n;r++)e=s.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function it(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function zs(s){let e="";for(let t in s)s.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(s[t]));return e}function Xs(s){let e={},t=s.split("&");for(let r=0,n=t.length;r<n;r++){let i=t[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}var Zs=B(he(),1),li=(0,Zs.default)("engine.io-client:transport"),lt=class extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}},se=class extends k{constructor(e){super(),this.writable=!1,te(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new lt(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"?this.write(e):li("transport is not open, discarding packets")}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=De(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){let t=zs(e);return t.length?"?"+t:""}};var er=B(he(),1),Y=(0,er.default)("engine.io-client:polling"),ye=class extends se{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";let t=()=>{Y("paused"),this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(Y("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){Y("pre-pause polling complete"),--r||t()})),this.writable||(Y("we are currently writing - waiting to pause"),r++,this.once("drain",function(){Y("pre-pause writing complete"),--r||t()}))}else t()}_poll(){Y("polling"),this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){Y("polling got data %s",e);let t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};Ws(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"?this._poll():Y('ignoring poll - transport state "%s"',this.readyState))}doClose(){let e=()=>{Y("writing close packet"),this.write([{type:"close"}])};this.readyState==="open"?(Y("transport open - closing"),e()):(Y("transport not open - deferring close"),this.once("open",e))}write(e){this.writable=!1,Ms(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=it()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}};var tr=!1;try{tr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}var sr=tr;var nr=B(he(),1),Xt=(0,nr.default)("engine.io-client:polling");function fi(){}var Ie=class extends ye{constructor(e){if(super(e),typeof location<"u"){let t=location.protocol==="https:",r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){let r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(n,i)=>{this.onError("xhr post error",n,i)})}doPoll(){Xt("xhr poll");let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}},Ce=(()=>{class s extends k{constructor(t,r,n){super(),this.createRequest=t,te(this,n),this._opts=n,this._method=n.method||"GET",this._uri=r,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var t;let r=nt(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");r.xdomain=!!this._opts.xd;let n=this._xhr=this.createRequest(r);try{Xt("xhr open %s: %s",this._method,this._uri),n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var i;n.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},Xt("xhr data %s",this._data),n.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=s.requestsCount++,s.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=fi,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete s.requests[this._index],this._xhr=null}}_onLoad(){let t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}return s.requestsCount=0,s.requests={},s})();if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",rr);else if(typeof addEventListener=="function"){let s="onpagehide"in q?"pagehide":"unload";addEventListener(s,rr,!1)}}function rr(){for(let s in Ce.requests)Ce.requests.hasOwnProperty(s)&&Ce.requests[s].abort()}var hi=function(){let s=ir({xdomain:!1});return s&&s.responseType!==null}(),ft=class extends Ie{constructor(e){super(e);let t=e&&e.forceBase64;this.supportsBinary=hi&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Ce(ir,this.uri(),e)}};function ir(s){let e=s.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||sr))return new XMLHttpRequest}catch{}if(!e)try{return new q[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}var ui=Yt.default||Yt,be=class extends Ie{request(e={}){var t;return Object.assign(e,{xd:this.xd,cookieJar:(t=this.socket)===null||t===void 0?void 0:t._cookieJar},this.opts),new Ce(r=>new ui(r),this.uri(),e)}};var vo=B(lr(),1),wo=B(os(),1),So=B(cs(),1),_s=B(ms(),1),ko=B(an(),1);var cn=B(he(),1),To=(0,cn.default)("engine.io-client:websocket"),ln=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",Xe=class extends se{get name(){return"websocket"}doOpen(){let e=this.uri(),t=this.opts.protocols,r=ln?{}:nt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],n=t===e.length-1;Pe(r,this.supportsBinary,i=>{try{this.doWrite(r,i)}catch{To("websocket closed before onclose event")}n&&ee(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=it()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},ys=q.WebSocket||q.MozWebSocket,wt=class extends Xe{createSocket(e,t,r){return ln?new ys(e,t,r):t?new ys(e,t):new ys(e)}doWrite(e,t){this.ws.send(t)}};var Se=class extends Xe{createSocket(e,t,r){var n;if(!((n=this.socket)===null||n===void 0)&&n._cookieJar){r.headers=r.headers||{},r.headers.cookie=typeof r.headers.cookie=="string"?[r.headers.cookie]:r.headers.cookie||[];for(let[i,a]of this.socket._cookieJar.cookies)r.headers.cookie.push(`${i}=${a.value}`)}return new _s.default(e,t,r)}doWrite(e,t){let r={};e.options&&(r.compress=e.options.compress),this.opts.perMessageDeflate&&(typeof t=="string"?Buffer.byteLength(t):t.length)<this.opts.perMessageDeflate.threshold&&(r.compress=!1),this.ws.send(t,r)}};var fn=B(he(),1),Ye=(0,fn.default)("engine.io-client:webtransport"),ke=class extends se{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{Ye("transport closed gracefully"),this.onClose()}).catch(e=>{Ye("transport closed due to %s",e),this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{let t=Vs(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),n=js();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();let i=()=>{r.read().then(({done:l,value:h})=>{if(l){Ye("session is closed");return}Ye("received chunk: %o",h),this.onPacket(h),i()}).catch(l=>{Ye("an error occurred while reading: %s",l)})};i();let a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let r=e[t],n=t===e.length-1;this._writer.write(r).then(()=>{n&&ee(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}};var Cs={websocket:Se,webtransport:ke,polling:be};var Fo=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,No=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Oe(s){if(s.length>8e3)throw"URI too long";let e=s,t=s.indexOf("["),r=s.indexOf("]");t!=-1&&r!=-1&&(s=s.substring(0,t)+s.substring(t,r).replace(/:/g,";")+s.substring(r,s.length));let n=Fo.exec(s||""),i={},a=14;for(;a--;)i[No[a]]=n[a]||"";return t!=-1&&r!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=Ro(i,i.path),i.queryKey=Lo(i,i.query),i}function Ro(s,e){let t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Lo(s,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,n,i){n&&(t[n]=i)}),t}var hn=B(he(),1),v=(0,hn.default)("engine.io-client:socket"),bs=typeof addEventListener=="function"&&typeof removeEventListener=="function",Ke=[];bs&&addEventListener("offline",()=>{v("closing %d connection(s) because the network was lost",Ke.length),Ke.forEach(s=>s())},!1);var St=(()=>{class s extends k{constructor(t,r){if(super(),this.binaryType=$s,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(r=t,t=null),t){let n=Oe(t);r.hostname=n.host,r.secure=n.protocol==="https"||n.protocol==="wss",r.port=n.port,n.query&&(r.query=n.query)}else r.host&&(r.hostname=Oe(r.host).host);te(this,r),this.secure=r.secure!=null?r.secure:typeof location<"u"&&location.protocol==="https:",r.hostname&&!r.port&&(r.port=this.secure?"443":"80"),this.hostname=r.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=r.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},r.transports.forEach(n=>{let i=n.prototype.name;this.transports.push(i),this._transportsByName[i]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},r),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Xs(this.opts.query)),bs&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(v("adding listener for the 'offline' event"),this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Ke.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=Hs()),this._open()}createTransport(t){v('creating transport "%s"',t);let r=Object.assign({},this.opts.query);r.EIO=$t,r.transport=t,this.id&&(r.sid=this.id);let n=Object.assign({},this.opts,{query:r,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return v("options: %j",n),new this._transportsByName[t](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let t=this.opts.rememberUpgrade&&s.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let r=this.createTransport(t);r.open(),this.setTransport(r)}setTransport(t){v("setting transport %s",t.name),this.transport&&(v("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",r=>this._onClose("transport close",r))}onOpen(){v("socket open"),this.readyState="open",s.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(v('socket receive: type "%s", data "%s"',t.type,t.data),this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let r=new Error("server error");r.code=t.data,this._onError(r);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}else v('packet received with socket readyState "%s"',this.readyState)}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let t=this._getWritablePackets();v("flushing %d packets in socket",t.length),this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let r=1;for(let n=0;n<this.writeBuffer.length;n++){let i=this.writeBuffer[n].data;if(i&&(r+=Gs(i)),n>0&&r>this._maxPayload)return v("only send %d out of %d packets",n,this.writeBuffer.length),this.writeBuffer.slice(0,n);r+=2}return v("payload size is %d (max: %d)",r,this._maxPayload),this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let t=Date.now()>this._pingTimeoutTime;return t&&(v("throttled timer detected, scheduling connection close"),this._pingTimeoutTime=0,ee(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,r,n){return this._sendPacket("message",t,r,n),this}send(t,r,n){return this._sendPacket("message",t,r,n),this}_sendPacket(t,r,n,i){if(typeof r=="function"&&(i=r,r=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;let a={type:t,data:r,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),i&&this.once("flush",i),this.flush()}close(){let t=()=>{this._onClose("forced close"),v("socket closing - telling transport to close"),this.transport.close()},r=()=>{this.off("upgrade",r),this.off("upgradeError",r),t()},n=()=>{this.once("upgrade",r),this.once("upgradeError",r)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():t()}):this.upgrading?n():t()),this}_onError(t){if(v("socket error %j",t),s.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return v("trying next transport"),this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,r){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(v('socket close with reason: "%s"',t),this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),bs&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){let n=Ke.indexOf(this._offlineEventListener);n!==-1&&(v("removing listener for the 'offline' event"),Ke.splice(n,1))}this.readyState="closed",this.id=null,this.emitReserved("close",t,r),this.writeBuffer=[],this._prevBufferLen=0}}}return s.protocol=$t,s})(),kt=class extends St{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade){v("starting upgrade probes");for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}}_probe(e){v('probing transport "%s"',e);let t=this.createTransport(e),r=!1;St.priorWebsocketSuccess=!1;let n=()=>{r||(v('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",c=>{if(!r)if(c.type==="pong"&&c.data==="probe"){if(v('probe transport "%s" pong',e),this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;St.priorWebsocketSuccess=t.name==="websocket",v('pausing current transport "%s"',this.transport.name),this.transport.pause(()=>{r||this.readyState!=="closed"&&(v("changing transport and sending upgrade packet"),o(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{v('probe transport "%s" failed',e);let f=new Error("probe error");f.transport=t.name,this.emitReserved("upgradeError",f)}}))};function i(){r||(r=!0,o(),t.close(),t=null)}let a=c=>{let f=new Error("probe error: "+c);f.transport=t.name,i(),v('probe transport "%s" failed because of error: %s',e,c),this.emitReserved("upgradeError",f)};function l(){a("transport closed")}function h(){a("socket closed")}function u(c){t&&c.name!==t.name&&(v('"%s" works - aborting "%s"',c.name,t.name),i())}let o=()=>{t.removeListener("open",n),t.removeListener("error",a),t.removeListener("close",l),this.off("close",h),this.off("upgrading",u)};t.once("open",n),t.once("error",a),t.once("close",l),this.once("close",h),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){let t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}},Te=class extends kt{constructor(e,t={}){let r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(n=>Cs[n]).filter(n=>!!n)),super(e,r)}};var Ot=class extends ye{doPoll(){this._fetch().then(e=>{if(!e.ok)return this.onError("fetch read error",e.status,e);e.text().then(t=>this.onData(t))}).catch(e=>{this.onError("fetch read error",e)})}doWrite(e,t){this._fetch(e).then(r=>{if(!r.ok)return this.onError("fetch write error",r.status,r);t()}).catch(r=>{this.onError("fetch write error",r)})}_fetch(e){var t;let r=e!==void 0,n=new Headers(this.opts.extraHeaders);return r&&n.set("content-type","text/plain;charset=UTF-8"),(t=this.socket._cookieJar)===null||t===void 0||t.appendCookies(n),fetch(this.uri(),{method:r?"POST":"GET",body:r?e:null,headers:n,credentials:this.opts.withCredentials?"include":"omit"}).then(i=>{var a;return(a=this.socket._cookieJar)===null||a===void 0||a.parseCookies(i.headers.getSetCookie()),i})}};var Hc=Te.protocol;var _n=B(Je(),1),gn=(0,_n.default)("socket.io-client:url");function yn(s,e="",t){let r=s;t=t||typeof location<"u"&&location,s==null&&(s=t.protocol+"//"+t.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s.charAt(1)==="/"?s=t.protocol+s:s=t.host+s),/^(https?|wss?):\/\//.test(s)||(gn("protocol-less url %s",s),typeof t<"u"?s=t.protocol+"//"+s:s="https://"+s),gn("parse %s",s),r=Oe(s)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";let i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}var Rs={};Mn(Rs,{Decoder:()=>Fs,Encoder:()=>Ts,PacketType:()=>C,protocol:()=>Fn});var Xo=typeof ArrayBuffer=="function",Yo=s=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(s):s.buffer instanceof ArrayBuffer,Cn=Object.prototype.toString,Ko=typeof Blob=="function"||typeof Blob<"u"&&Cn.call(Blob)==="[object BlobConstructor]",Jo=typeof File=="function"||typeof File<"u"&&Cn.call(File)==="[object FileConstructor]";function Ze(s){return Xo&&(s instanceof ArrayBuffer||Yo(s))||Ko&&s instanceof Blob||Jo&&s instanceof File}function Qe(s,e){if(!s||typeof s!="object")return!1;if(Array.isArray(s)){for(let t=0,r=s.length;t<r;t++)if(Qe(s[t]))return!0;return!1}if(Ze(s))return!0;if(s.toJSON&&typeof s.toJSON=="function"&&arguments.length===1)return Qe(s.toJSON(),!0);for(let t in s)if(Object.prototype.hasOwnProperty.call(s,t)&&Qe(s[t]))return!0;return!1}function bn(s){let e=[],t=s.data,r=s;return r.data=vs(t,e),r.attachments=e.length,{packet:r,buffers:e}}function vs(s,e){if(!s)return s;if(Ze(s)){let t={_placeholder:!0,num:e.length};return e.push(s),t}else if(Array.isArray(s)){let t=new Array(s.length);for(let r=0;r<s.length;r++)t[r]=vs(s[r],e);return t}else if(typeof s=="object"&&!(s instanceof Date)){let t={};for(let r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=vs(s[r],e));return t}return s}function En(s,e){return s.data=ws(s.data,e),delete s.attachments,s}function ws(s,e){if(!s)return s;if(s&&s._placeholder===!0){if(typeof s.num=="number"&&s.num>=0&&s.num<e.length)return e[s.num];throw new Error("illegal attachments")}else if(Array.isArray(s))for(let t=0;t<s.length;t++)s[t]=ws(s[t],e);else if(typeof s=="object")for(let t in s)Object.prototype.hasOwnProperty.call(s,t)&&(s[t]=ws(s[t],e));return s}var Tn=B(kn(),1),Os=(0,Tn.default)("socket.io-parser"),da=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Fn=5,C=function(s){return s[s.CONNECT=0]="CONNECT",s[s.DISCONNECT=1]="DISCONNECT",s[s.EVENT=2]="EVENT",s[s.ACK=3]="ACK",s[s.CONNECT_ERROR=4]="CONNECT_ERROR",s[s.BINARY_EVENT=5]="BINARY_EVENT",s[s.BINARY_ACK=6]="BINARY_ACK",s}(C||{}),Ts=class{constructor(e){this.replacer=e}encode(e){return Os("encoding packet %j",e),(e.type===C.EVENT||e.type===C.ACK)&&Qe(e)?this.encodeAsBinary({type:e.type===C.EVENT?C.BINARY_EVENT:C.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===C.BINARY_EVENT||e.type===C.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),Os("encoded %j as %s",e,t),t}encodeAsBinary(e){let t=bn(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}};function On(s){return Object.prototype.toString.call(s)==="[object Object]"}var Fs=class s extends k{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let r=t.type===C.BINARY_EVENT;r||t.type===C.BINARY_ACK?(t.type=r?C.EVENT:C.ACK,this.reconstructor=new Ns(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Ze(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,r={type:Number(e.charAt(0))};if(C[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===C.BINARY_EVENT||r.type===C.BINARY_ACK){let i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let a=e.substring(i,t);if(a!=Number(a)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(a)}if(e.charAt(t+1)==="/"){let i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(i,t)}else r.nsp="/";let n=e.charAt(t+1);if(n!==""&&Number(n)==n){let i=t+1;for(;++t;){let a=e.charAt(t);if(a==null||Number(a)!=a){--t;break}if(t===e.length)break}r.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){let i=this.tryParse(e.substr(t));if(s.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return Os("decoded %s as %j",e,r),r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case C.CONNECT:return On(t);case C.DISCONNECT:return t===void 0;case C.CONNECT_ERROR:return typeof t=="string"||On(t);case C.EVENT:case C.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&da.indexOf(t[0])===-1);case C.ACK:case C.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},Ns=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=En(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function H(s,e,t){return s.on(e,t),function(){s.off(e,t)}}var Nn=B(Je(),1),T=(0,Nn.default)("socket.io-client:socket"),pa=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Fe=class extends k{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[H(e,"open",this.onopen.bind(this)),H(e,"packet",this.onpacket.bind(this)),H(e,"error",this.onerror.bind(this)),H(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,n,i;if(pa.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let a={type:C.EVENT,data:t};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let o=this.ids++;T("emitting packet with ack id %d",o);let c=t.pop();this._registerAckCallback(o,c),a.id=o}let l=(n=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||n===void 0?void 0:n.writable,h=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!l?T("discard packet as the transport is not currently writable"):h?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a),this.flags={},this}_registerAckCallback(e,t){var r;let n=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(n===void 0){this.acks[e]=t;return}let i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===e&&(T("removing packet with ack id %d from the buffer",e),this.sendBuffer.splice(l,1));T("event with ack id %d has timed out after %d ms",e,n),t.call(this,new Error("operation has timed out"))},n),a=(...l)=>{this.io.clearTimeoutFn(i),t.apply(this,l)};a.withError=!0,this.acks[e]=a}emitWithAck(e,...t){return new Promise((r,n)=>{let i=(a,l)=>a?n(a):r(l);i.withError=!0,t.push(i),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((n,...i)=>r!==this._queue[0]?void 0:(n!==null?r.tryCount>this._opts.retries&&(T("packet [%d] is discarded after %d tries",r.id,r.tryCount),this._queue.shift(),t&&t(n)):(T("packet [%d] was successfully sent",r.id),this._queue.shift(),t&&t(null,...i)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(T("draining queue"),!this.connected||this._queue.length===0)return;let t=this._queue[0];if(t.pending&&!e){T("packet [%d] has already been sent and is waiting for an ack",t.id);return}t.pending=!0,t.tryCount++,T("sending packet [%d] (try n\xB0%d)",t.id,t.tryCount),this.flags=t.flags,this.emit.apply(this,t.args)}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){T("transport is open - connecting"),typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:C.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){T("close (%s)",e),this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){let r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case C.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case C.EVENT:case C.BINARY_EVENT:this.onevent(e);break;case C.ACK:case C.BINARY_ACK:this.onack(e);break;case C.DISCONNECT:this.ondisconnect();break;case C.CONNECT_ERROR:this.destroy();let r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){let t=e.data||[];T("emitting event %j",t),e.id!=null&&(T("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,r=!1;return function(...n){r||(r=!0,T("sending ack %j",n),t.packet({type:C.ACK,id:e,data:n}))}}onack(e){let t=this.acks[e.id];if(typeof t!="function"){T("bad ack %s",e.id);return}delete this.acks[e.id],T("calling ack %s with %j",e.id,e.data),t.withError&&e.data.unshift(null),t.apply(this,e.data)}onconnect(e,t){T("socket connected with id %s",e),this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){T("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&(T("performing disconnect (%s)",this.nsp),this.packet({type:C.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let r of t)r.apply(this,e.data)}}};function ge(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}ge.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*s);s=Math.floor(e*10)&1?s+t:s-t}return Math.min(s,this.max)|0};ge.prototype.reset=function(){this.attempts=0};ge.prototype.setMin=function(s){this.ms=s};ge.prototype.setMax=function(s){this.max=s};ge.prototype.setJitter=function(s){this.jitter=s};var Rn=B(Je(),1),P=(0,Rn.default)("socket.io-client:manager"),Ne=class extends k{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,te(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new ge({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let n=t.parser||Rs;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(P("readyState %s",this._readyState),~this._readyState.indexOf("open"))return this;P("opening %s",this.uri),this.engine=new Te(this.uri,this.opts);let t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;let n=H(t,"open",function(){r.onopen(),e&&e()}),i=l=>{P("error"),this.cleanup(),this._readyState="closed",this.emitReserved("error",l),e?e(l):this.maybeReconnectOnOpen()},a=H(t,"error",i);if(this._timeout!==!1){let l=this._timeout;P("connect attempt will timeout after %d",l);let h=this.setTimeoutFn(()=>{P("connect attempt timed out after %d",l),n(),i(new Error("timeout")),t.close()},l);this.opts.autoUnref&&h.unref(),this.subs.push(()=>{this.clearTimeoutFn(h)})}return this.subs.push(n),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){P("open"),this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(H(e,"ping",this.onping.bind(this)),H(e,"data",this.ondata.bind(this)),H(e,"error",this.onerror.bind(this)),H(e,"close",this.onclose.bind(this)),H(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){ee(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){P("error",e),this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Fe(this,e,t),this.nsps[e]=r),r}_destroy(e){let t=Object.keys(this.nsps);for(let r of t)if(this.nsps[r].active){P("socket %s is still active, skipping close",r);return}this._close()}_packet(e){P("writing packet %j",e);let t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){P("cleanup"),this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){P("disconnect"),this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;P("closed due to %s",e),this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)P("reconnect failed"),this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();P("will wait %dms before reconnect attempt",t),this._reconnecting=!0;let r=this.setTimeoutFn(()=>{e.skipReconnect||(P("attempting reconnect"),this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(P("reconnect attempt error"),e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):(P("reconnect success"),e.onreconnect())}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var An=B(Je(),1),Ln=(0,An.default)("socket.io-client"),et={};function Ls(s,e){typeof s=="object"&&(e=s,s=void 0),e=e||{};let t=yn(s,e.path||"/socket.io"),r=t.source,n=t.id,i=t.path,a=et[n]&&i in et[n].nsps,l=e.forceNew||e["force new connection"]||e.multiplex===!1||a,h;return l?(Ln("ignoring socket cache for %s",r),h=new Ne(r,e)):(et[n]||(Ln("new io instance for %s",r),et[n]=new Ne(r,e)),h=et[n]),t.query&&!e.query&&(e.query=t.queryKey),h.socket(t.path,e)}Object.assign(Ls,{Manager:Ne,Socket:Fe,io:Ls,connect:Ls});export{Ot as Fetch,Ne as Manager,Se as NodeWebSocket,be as NodeXHR,Fe as Socket,wt as WebSocket,ke as WebTransport,ft as XHR,Ls as connect,Ls as default,Ls as io,Fn as protocol};

<div class="report-root">
  <!-- Header -->
  <div class="report-header">
    <h1 class="report-title">Weekly Report</h1>
    <p class="report-desc">
      Track your weekly expenses, savings vs last week, and week-over-week improvement
    </p>
  </div>

  <!-- Period Selector -->
  <div class="report-card report-period-selector">
    <app-period-selector
      [periods]="availableWeeks"
      [selectedPeriod]="selectedWeek"
      [loading]="loading"
      periodType="week"
      (periodSelected)="onWeekSelected($event)"
      (refresh)="onRefresh()"></app-period-selector>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="report-loading">
    <div class="report-spinner"></div>
  </div>

  <!-- Error Card -->
  <div *ngIf="error && !loading" class="report-card report-error">
    <div class="report-error-content">
      <span class="report-error-icon">&#9888;</span>
      <div>
        <h4>Error Loading Report</h4>
        <p>{{ error }}</p>
        <button (click)="onRefresh()">Try again</button>
      </div>
    </div>
  </div>

  <!-- Filter Bar -->
  <div *ngIf="isFiltered()" class="report-filter-bar">
    <span>Filtering by: <b class="filter-value">{{ selectedCategory }}</b></span>
    <button (click)="clearCategoryFilter()">Clear Filter</button>
  </div>

  <!-- Main Data -->
  <div *ngIf="reportData && !loading">
    <!-- Summary Cards -->
    <div class="report-cards-row">
      <div class="report-card">
        <app-summary-card
          title="Weekly Expenses"
[value]="!selectedCategory ? (reportData?.totalExpense ?? 0) : (filteredExpense ?? 0)"
      [comparison]="expenseComparison"
          type="expense"></app-summary-card>
      </div>
    </div>

    <!-- Charts Row: Pie & Bar side by side -->
    <div class="report-charts-row">
      <div class="report-card chart-card half-chart">
        <div class="chart-title">Category Breakdown</div>
        <div #pieChart id="pieChart" class="chart-container"></div>
      </div>
      <div class="report-card chart-card half-chart">
        <div class="chart-title">Daily Expenses Bar Chart</div>
        <div #barChart id="barChart" class="chart-container"></div>
      </div>
    </div>

    <!-- âœ… REMOVED Comparison Chart Section Completely -->

    <!-- Enhanced Daily Breakdown Table -->
    <div class="report-card report-table-card">
      <div class="report-table-title">
        {{ selectedCategory ? selectedCategory + ' - Daily Breakdown' : 'Category Summary' }}
      </div>
      
      <!-- Category Summary Table (when no category selected) -->
      <div *ngIf="!selectedCategory" class="report-table-wrapper">
        <table class="report-table">
          <thead>
            <tr>
              <th>Category</th>
              <th>Current Week</th>
              <th>Previous Week</th>
              <th>Change</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let category of filteredCategories"
                (click)="onCategoryClick(category.category)"
                [class.row-selected]="selectedCategory === category.category">
              <td>{{ category.category }}</td>
              <td class="amount">{{ category.amount | currency:'INR':'symbol':'1.0-0' }}</td>
              <td>
                <ng-container *ngIf="reportData?.previousWeek?.category as prevCategories">
                  {{ findCategoryAmount(getFilteredPrevCategories(prevCategories), category.category) | currency:'INR':'symbol':'1.0-0' }}
                </ng-container>
              </td>
              <td>
                <ng-container *ngIf="reportData?.previousWeek?.category as prevCategories">
                  <span
                    class="change-badge"
                    [class.badge-pos]="getCategoryChange(category, getFilteredPrevCategories(prevCategories)) < 0"
                    [class.badge-neg]="getCategoryChange(category, getFilteredPrevCategories(prevCategories)) > 0"
                    [class.badge-neutral]="getCategoryChange(category, getFilteredPrevCategories(prevCategories)) === 0"
                  >
                    {{ getCategoryChange(category, getFilteredPrevCategories(prevCategories)) | percentage }}
                  </span>
                </ng-container>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Daily Breakdown Table (when category is selected) -->
      <div *ngIf="selectedCategory" class="report-table-wrapper">
        <table class="report-table daily-breakdown-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Day</th>
              <th>Current Week ({{ selectedCategory }})</th>
              <th>Previous Week ({{ selectedCategory }})</th>
              <th>Difference</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let dayData of getDailyBreakdownData()" 
                [class.has-current]="dayData.currentAmount > 0"
                [class.has-previous]="dayData.previousAmount > 0">
              <td>{{ dayData.date | date:'shortDate' }}</td>
              <td>{{ dayData.dayName }}</td>
              <td class="amount" [class.zero-amount]="dayData.currentAmount === 0">
                {{ dayData.currentAmount | currency:'INR':'symbol':'1.0-0' }}
              </td>
              <td class="amount" [class.zero-amount]="dayData.previousAmount === 0">
                {{ dayData.previousAmount | currency:'INR':'symbol':'1.0-0' }}
              </td>
              <td class="amount">
                <span [class.positive-diff]="dayData.difference > 0" 
                      [class.negative-diff]="dayData.difference < 0"
                      [class.neutral-diff]="dayData.difference === 0">
                  {{ dayData.difference | currency:'INR':'symbol':'1.0-0' }}
                </span>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr class="total-row">
              <td colspan="2"><strong>Total</strong></td>
              <td class="amount"><strong>{{ getDailyBreakdownTotals().currentTotal | currency:'INR':'symbol':'1.0-0' }}</strong></td>
              <td class="amount"><strong>{{ getDailyBreakdownTotals().previousTotal | currency:'INR':'symbol':'1.0-0' }}</strong></td>
              <td class="amount">
                <strong [class.positive-diff]="getDailyBreakdownTotals().totalDifference > 0" 
                        [class.negative-diff]="getDailyBreakdownTotals().totalDifference < 0"
                        [class.neutral-diff]="getDailyBreakdownTotals().totalDifference === 0">
                  {{ getDailyBreakdownTotals().totalDifference | currency:'INR':'symbol':'1.0-0' }}
                </strong>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!reportData && !loading && !error" class="report-card report-empty">
    <div class="empty-icon">&#128202;</div>
    <h4>No data available</h4>
    <p>Select a week to view your report data.</p>
  </div>
</div>

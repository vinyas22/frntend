<div class="yearly-report-container">
  <!-- Header Section -->
  <div class="report-header">
    <div class="header-content">
      <h1 class="report-title">Monthly Financial Report</h1>
      <div class="year-selector">
        <label for="month-select">Select Month:</label>
        <input 
          id="month-select"
          type="month"
          [(ngModel)]="selectedMonth" 
          (change)="onMonthChange()"
          [disabled]="isLoading"
          class="year-dropdown">
        <div class="loading-spinner" *ngIf="isLoading">
          <span>Loading month...</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Message -->
  <div class="error-message" *ngIf="errorMessage">
    <div class="error-content">
      <i class="error-icon">⚠️</i>
      <span>{{ errorMessage }}</span>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <span>Loading monthly report...</span>
    </div>
  </div>

  <!-- Report Content -->
  <div class="report-content" *ngIf="!isLoading && !errorMessage && displayReportData">
    
    <!-- Month Overview (Same as Year Overview) -->
    <div class="year-overview">
      <div class="overview-card">
        <h2>{{ getMonthName() }}</h2>
        <div class="overview-stats">
          <div class="stat-item income">
            <span class="stat-label">Total Income</span>
            <span class="stat-value">{{ formatAsINR(fullReportData?.totalIncome || 0) }}</span>
          </div>
          <div class="stat-item expense">
            <span class="stat-label">Total Expenses</span>
            <span class="stat-value">{{ formatAsINR(displayReportData.totalExpense || 0) }}</span>
          </div>
          <div class="stat-item savings">
            <span class="stat-label">Total Savings</span>
            <span class="stat-value" [class.positive]="getMonthSavings() > 0" [class.negative]="getMonthSavings() < 0">
              {{ formatAsINR(getMonthSavings()) }}
            </span>
          </div>
          <div class="stat-item savings-rate">
            <span class="stat-label">Savings Rate</span>
            <span class="stat-value" [class.positive]="getMonthSavingsRate() > 0" [class.negative]="getMonthSavingsRate() < 0">
              {{ getMonthSavingsRate() }}%
            </span>
          </div>
        </div>
        
        <!-- Previous Month Comparison -->
        <div class="comparison-stats" *ngIf="fullReportData?.previousMonth">
          <h3>Month-over-Month Comparison</h3>
          <div class="comparison-grid">
            <div class="comparison-item">
              <span class="label">Income Change</span>
              <span class="value" 
                    [class.positive]="getIncomeChange() > 0"
                    [class.negative]="getIncomeChange() < 0">
                {{ getIncomeChange() > 0 ? '+' : '' }}{{ formatAsINR(getIncomeChange()) }}
              </span>
            </div>
            <div class="comparison-item">
              <span class="label">Expense Change</span>
              <span class="value" 
                    [class.positive]="getExpenseChange() < 0"
                    [class.negative]="getExpenseChange() > 0">
                {{ getExpenseChange() > 0 ? '+' : '' }}{{ formatAsINR(getExpenseChange()) }}
              </span>
            </div>
            <div class="comparison-item">
              <span class="label">Savings Change</span>
              <span class="value" 
                    [class.positive]="getSavingsChange() > 0"
                    [class.negative]="getSavingsChange() < 0">
                {{ getSavingsChange() > 0 ? '+' : '' }}{{ formatAsINR(getSavingsChange()) }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      
      <!-- Category Breakdown Chart -->
      <div class="chart-container">
        <div class="chart-header">
          <h3>Monthly Expense Categories</h3>
          <button class="clear-filter-btn" *ngIf="selectedCategoryFilter" (click)="clearFilter()">
            Clear Filter
          </button>
        </div>
        <div class="chart-wrapper">
          <div echarts 
               [options]="pieChartOptions" 
               (chartClick)="onChartClick($event)"
               class="pie-chart">
          </div>
        </div>
      </div>

  

      <!-- Month-over-Month Comparison -->
      <div class="chart-container" *ngIf="fullReportData?.previousMonth">
        <div class="chart-header">
          <h3>
            Month-over-Month Comparison
            <span *ngIf="selectedCategoryFilter" class="filter-indicator">
              ({{ selectedCategoryFilter }})
            </span>
          </h3>
        </div>
        <div class="chart-wrapper">
          <div echarts 
               [options]="comparisonChartOptions" 
               class="quarter-comparison-chart">
          </div>
        </div>
      </div>
    </div>

    <!-- Category Details Table -->
  <div class="overflow-x-auto rounded-lg border border-gray-200 shadow-md">
  <table class="min-w-full divide-y divide-gray-200">
    <thead class="bg-gray-50 sticky top-0 z-10">
      <tr>
        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
          Category
        </th>
        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
          Current Quarter
        </th>
        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider" *ngIf="fullReportData?.previousMonth">
          Previous Quarter
        </th>
        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider" *ngIf="fullReportData?.previousMonth">
          Change
        </th>
        <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
          % of Total
        </th>
      </tr>
    </thead>
    <tbody class="bg-white divide-y divide-gray-200">
      <tr *ngFor="let category of fullReportData?.category"
          [class.selected]="selectedCategoryFilter === (category.category || 'Uncategorized')"
          (click)="toggleCategoryFilter(category.category || 'Uncategorized')"
          class="cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700">
        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">
          {{ category.category || 'Uncategorized' }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 dark:text-gray-100">
          {{ formatAsINR(category.amount || 0) }}
        </td>
        <td *ngIf="fullReportData?.previousMonth" class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500 dark:text-gray-300">
          {{ formatAsINR(getPreviousAmount(category.category || 'Uncategorized')) }}
        </td>
        <td *ngIf="fullReportData?.previousMonth"
            class="px-6 py-4 whitespace-nowrap text-sm text-right"
            [class.text-green-600]="getChangeAmount(category.category || 'Uncategorized') < 0"
            [class.text-red-600]="getChangeAmount(category.category || 'Uncategorized') > 0">
          {{ getChangeAmount(category.category || 'Uncategorized') > 0 ? '+' : '' }}
          {{ formatAsINR(getChangeAmount(category.category || 'Uncategorized')) }}
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500 dark:text-gray-300">
          {{ getCategoryPercentage(category.amount || 0) }}%
        </td>
      </tr>
    </tbody>
  </table>
</div>


    <!-- Daily Breakdown Table -->
    <!-- <div class="monthly-breakdown">
      <div class="breakdown-header">
        <h3>Daily Breakdown</h3>
      </div>
      
      <div class="monthly-table">
        <div class="monthly-table-header">
          <span class="col-month">Day</span>
          <span class="col-expenses">Expenses</span>
          <span class="col-previous" *ngIf="fullReportData?.previousMonth">Previous Month</span>
          <span class="col-change" *ngIf="fullReportData?.previousMonth">Change</span>
        </div>
        
        <div class="monthly-table-row" *ngFor="let dayData of getDailyBreakdownData()">
          <span class="col-month">{{ dayData.dayName }} - {{ dayData.date | date:'shortDate' }}</span>
          <span class="col-expenses">{{ formatAsINR(dayData.currentAmount) }}</span>
          <span class="col-previous" *ngIf="fullReportData?.previousMonth">
            {{ formatAsINR(dayData.previousAmount) }}
          </span>
          <span class="col-change" *ngIf="fullReportData?.previousMonth"
                [class.positive]="dayData.difference < 0"
                [class.negative]="dayData.difference > 0">
            {{ dayData.difference > 0 ? '+' : '' }}{{ formatAsINR(dayData.difference) }}
          </span>
        </div>
      </div>
    </div> -->

    <!-- Detailed Category Breakdown -->
  <div *ngIf="selectedCategoryFilter" class="detailed-breakdown p-4 rounded-lg border border-gray-200 shadow-md overflow-x-auto dark:border-gray-700 dark:bg-gray-800">
  <div class="breakdown-header flex justify-between items-center mb-4">
    <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100">
      {{ selectedCategoryFilter }} - Daily Details
    </h3>
    <button (click)="clearFilter()" class="text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 focus:outline-none">
      ✕
    </button>
  </div>

  <div class="detailed-summary mb-4 grid grid-cols-1 sm:grid-cols-3 gap-4 text-gray-800 dark:text-gray-200">
    <div class="summary-item">
      <span class="label block text-sm font-medium">Current Month Total:</span>
      <span class="value block mt-1 font-semibold">{{ formatAsINR(getCategoryTotalForMonth()) }}</span>
    </div>
    <div class="summary-item" *ngIf="fullReportData?.previousMonth">
      <span class="label block text-sm font-medium">Previous Month Total:</span>
      <span class="value block mt-1 font-semibold">{{ formatAsINR(getPreviousAmount(selectedCategoryFilter)) }}</span>
    </div>
    <div class="summary-item change-summary" *ngIf="fullReportData?.previousMonth">
      <span class="label block text-sm font-medium">Difference:</span>
      <span class="value block mt-1 font-semibold"
            [class.text-green-600]="getChangeAmount(selectedCategoryFilter) < 0"
            [class.text-red-600]="getChangeAmount(selectedCategoryFilter) > 0">
        {{ getChangeAmount(selectedCategoryFilter) > 0 ? '+' : '' }}{{ formatAsINR(getChangeAmount(selectedCategoryFilter)) }}
      </span>
    </div>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
      <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0 z-10">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
            Day
          </th>
          <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
            Current Month
          </th>
          <th *ngIf="fullReportData?.previousMonth"
              class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
            Previous Month
          </th>
          <!-- <th *ngIf="fullReportData?.previousMonth"
              class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
            Difference
          </th> -->
        </tr>
      </thead>
      <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700">
        <tr *ngFor="let day of getDailyBreakdownData()" class="hover:bg-gray-100 dark:hover:bg-gray-900">
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">
            {{ day.dayName }} - {{ day.date | date:'shortDate' }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 dark:text-gray-100">
            {{ formatAsINR(day.currentAmount) }}
          </td>
          <td *ngIf="fullReportData?.previousMonth"
              class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500 dark:text-gray-300">
            {{ formatAsINR(day.previousAmount) }}
          </td>
          <!-- <td *ngIf="fullReportData?.previousMonth"
              class="px-6 py-4 whitespace-nowrap text-sm text-right"
              [class.text-green-600]="day.difference < 0"
              [class.text-red-600]="day.difference > 0">
            {{ day.difference > 0 ? '+' : '' }}{{ formatAsINR(day.difference) }}
          </td> -->
        </tr>

        <!-- Totals Row -->
        <tr class="border-t-2 border-gray-300 dark:border-gray-600 font-semibold bg-gray-50 dark:bg-gray-700">
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100">Total</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-900 dark:text-gray-100">
            {{ formatAsINR(getDailyBreakdownTotals().currentTotal) }}
          </td>
          <td *ngIf="fullReportData?.previousMonth"
              class="px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500 dark:text-gray-300">
            {{ formatAsINR(getDailyBreakdownTotals().previousTotal) }}
          </td>
          <!-- <td *ngIf="fullReportData?.previousMonth"
              class="px-6 py-4 whitespace-nowrap text-sm text-right"
              [class.text-green-600]="getDailyBreakdownTotals().totalDifference < 0"
              [class.text-red-600]="getDailyBreakdownTotals().totalDifference > 0">
            {{ getDailyBreakdownTotals().totalDifference > 0 ? '+' : '' }}{{ formatAsINR(getDailyBreakdownTotals().totalDifference) }}
          </td> -->
        </tr>
      </tbody>
    </table>
  </div>
</div>


  </div>
</div>
